<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ODORIS - Perfumy Luksusowych Producentów</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* === ZMIENNE KOLORÓW I FONTÓW === */
        :root {
            --color-background-light: #F8F8F4;
            --color-background-dark: #1A1A1A;
            --color-text-dark: #1A1A1A;
            --color-text-light: #F8F8F4;
            --color-accent-gold: #C0A04C;
            --font-serif: 'Playfair Display', serif;
            --font-sans: 'Lato', sans-serif;
        }

        /* === GLOBALNE STYLE === */
        body {
            font-family: var(--font-sans);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            background-color: var(--color-background-dark);
            overflow-x: hidden;
        }
        
        h1, h2, h3, h4 {
            font-family: var(--font-serif);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .gold-text {
            color: var(--color-accent-gold);
            font-weight: 700;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* === PRZEŁĄCZANIE WIDOKÓW === */
        .page-section {
            display: none;
            background-color: var(--color-background-dark);
            color: var(--color-text-light);
            min-height: 100vh;
        }
        .page-section.active {
            display: block;
        }
        
      /* === Nagłówek i Aktywny Link (dla podstron) === */
header {
    text-align: center;
    padding: 25px 0;
    /* Linia oddzielająca nagłówek musi być jasna lub usunięta, aby pasowała do ciemnego tła */
    border-bottom: 1px solid rgba(255, 255, 255, 0.1); 
    background-color: #222; /* <--- NOWY, CIEMNY KOLOR */
    position: sticky;
    top: 0;
    z-index: 10;
}
        
        header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        header nav a {
            color: var(--color-text-light);
            text-decoration: none;
            font-size: 13px;
            margin: 0 12px;
            text-transform: uppercase;
            transition: color 0.3s, border-bottom 0.3s;
            cursor: pointer;
        }
        
        /* === NOWY STYL DLA LICZNIKA KOSZYKA === */
        header nav a .cart-counter {
            background-color: var(--color-accent-gold);
            color: var(--color-background-dark);
            border-radius: 50%;
            padding: 0px 5px;
            font-size: 0.8em;
            font-weight: 700;
            min-width: 18px;
            display: inline-block;
            line-height: 18px;
            text-align: center;
            position: relative;
            top: -2px;
        }

        .active-nav-link {
            color: var(--color-accent-gold) !important;
            font-weight: 700;
            border-bottom: 2px solid var(--color-accent-gold);
            padding-bottom: 5px;
        }
        
        /* === SIDE MENU I HAMBURGER === */
        #side-menu {
            height: 100%; width: 0; position: fixed; z-index: 20; top: 0; right: 0;
            background-color: rgba(26, 26, 26, 0.95); overflow-x: hidden; transition: 0.5s;
            padding-top: 60px; color: var(--color-text-light); text-align: center;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.5);
        }
        #side-menu.open { width: 300px; }
        #side-menu a {
            padding: 15px 8px 15px 32px; text-decoration: none; font-size: 18px;
            color: var(--color-text-light); display: block; transition: 0.3s;
            text-transform: uppercase; letter-spacing: 2px; font-family: var(--font-serif);
            cursor: pointer;
        }
        #side-menu a:hover { color: var(--color-accent-gold); background-color: #222; }
        #side-menu .closebtn { position: absolute; top: 0; right: 25px; font-size: 36px; margin-left: 50px; font-weight: 300; }
        
        /* === NOWY STYL DLA LICZNIKA KOSZYKA W SIDE-MENU === */
        #side-menu a .cart-counter {
            background-color: var(--color-accent-gold);
            color: var(--color-background-dark);
            border-radius: 50%;
            padding: 2px 7px;
            font-size: 0.8em;
            font-weight: 700;
            display: inline-block;
            line-height: normal;
        }
        
        /* Globalny styl dla hamburgera */
        .menu-toggle {
            font-size: 30px; cursor: pointer;
            z-index: 15; transition: color 0.3s; line-height: 1;
        }
        /* Hamburger dla Landing Page (Ciemny widok) */
        #landing-page .menu-toggle {
            position: absolute; top: 40px; right: 40px;
            color: var(--color-text-light);
        }
        #landing-page .menu-toggle:hover { color: var(--color-accent-gold); }
       /* Hamburger dla Podstron (Ciemny widok) */
header .menu-toggle {
    color: var(--color-text-light); /* <--- NOWY, JASNY KOLOR DLA IKONY */
    margin-left: auto;
    padding-right: 15px;
}
        header .menu-toggle:hover { color: var(--color-accent-gold); }

        /* === STYLE LANDING PAGE === */
        #landing-page {
            background-color: var(--color-background-dark);
            color: var(--color-text-light);
            text-align: center;
            min-height: auto;
        }

       .hero-section {
    /* Używamy publicznego obrazu z internetu jako tła */
    background-image:
        /* Warstwa przyciemniająca (gradient), aby tekst był czytelny */
        linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.8)),
        
        /* Link do obrazu tła (zdjęcie kwiatów i perfum) */
        url('tlo-hero.png.png');

    /* Ustawiamy pozycjonowanie tła */
    background-size: cover; /* Aby obrazek zawsze pokrywał całą sekcję */
    background-position: center center; /* Aby obrazek był wyśrodkowany */

    /* Reszta Twoich starych stylów (bez zmian) */
    padding: 180px 20px 140px 20px;
    position: relative;

    /* NOWY KOD: Bardzo długie i płynne przejście */
    -webkit-mask-image: linear-gradient(to bottom, black 55%, transparent 100%);
    mask-image: linear-gradient(to bottom, black 55%, transparent 100%);
}
        
        .hero-content h1 { font-size: 4em; letter-spacing: 8px; margin-bottom: 5px; font-weight: 900; }
        .hero-slogan { font-size: 1.2em; margin-bottom: 40px; font-weight: 400; letter-spacing: 3px; }
        .hero-content p { font-family: var(--font-sans); font-size: 1.2em; margin-bottom: 40px; color: rgba(255, 255, 255, 0.9); }
       .btn-main {
            display: inline-block;
            padding: 16px 60px;
            
            /* === NOWE, ZŁOTE STYLE === */
            background-color: #EACD76; /* Jaśniejszy złoty kolor tła */
            color: #332A14; /* Ciemniejszy kolor tekstu dla kontrastu */
            box-shadow: 0 4px 25px rgba(234, 205, 118, 0.6); /* Mocniejszy złoty cień */
            border: 1px solid #D4B76A; /* Ciemniejsza złota ramka */
            /* === KONIEC ZMIAN === */
            
            text-decoration: none;
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 2px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .btn-main:hover {
            background-color: transparent;
            color: #EACD76; /* Złoty tekst po najechaniu */
            border: 1px solid #EACD76; /* Złota ramka po najechaniu */
            box-shadow: 0 2px 10px rgba(234, 205, 118, 0.3); /* Delikatniejszy cień */
        }
        
        .values-section, .detail-section { background-color: var(--color-background-dark); color: var(--color-text-light); }
        .values-section { padding: 100px 0; }
        .values-section .value-cards { display: flex; justify-content: space-around; gap: 30px; margin-top: 40px; }
        .values-section .card { flex-basis: 30%; padding: 30px; border: 1px solid rgba(192, 160, 76, 0.3); background-color: #222; }
        .detail-section { padding: 120px 0; }
        .detail-section .content-2col { display: flex; gap: 40px; align-items: flex-start; }
        .detail-section .image-mock { flex: 1; min-height: 400px; border: 4px solid var(--color-accent-gold); box-shadow: 0 0 20px rgba(192, 160, 76, 0.2); background-color: #000; }
        
        /* MINI-FOOTER NA LANDING PAGE */
        .mini-footer { background-color: #101010; color: rgba(255, 255, 255, 0.5); padding: 30px 0; font-size: 0.8em; display: flex; justify-content: space-between; align-items: center; }
        .social-icons a { color: var(--color-text-light); text-decoration: none; font-size: 1.3em; margin: 0 10px; transition: color 0.3s; }
        .social-icons a:hover { color: var(--color-accent-gold); }
        .social-icons span { margin-right: 15px; color: var(--color-accent-gold); font-weight: 700; text-transform: uppercase; font-size: 1em; }
        
        /* ULEPSZONA STOPKA GLOBALNA */
        footer { background-color: #222; color: var(--color-text-light); padding: 40px 0; font-size: 0.85em; }
        .footer-content { display: flex; justify-content: space-between; gap: 30px; }
        .footer-links h4, .footer-contact h4 { color: var(--color-accent-gold); font-size: 1em; margin-top: 0; margin-bottom: 15px; letter-spacing: 1px; }
        .footer-links a { display: block; color: #AAA; text-decoration: none; margin-bottom: 5px; transition: color 0.3s; font-size: 0.9em; cursor: pointer; }
        .footer-links a:hover { color: var(--color-text-light); }
        .footer-contact strong { display: block; margin-top: 10px; font-size: 0.85em; font-weight: 700; }
        .footer-contact a { color: var(--color-text-light); text-decoration: none; font-size: 1.1em; display: inline-block; }
        .copyright { flex-basis: 100%; text-align: center; padding-top: 20px; border-top: 1px solid #333; margin-top: 20px; font-size: 0.75em; color: #666; line-height: 1.4; }

        /* === STYLE DLA CHATBOTA === */
      .chatbot-container {
    background-color: #1a1a1a; /* Ciemniejsze tło kontenera */
    border: 1px solid #444; /* Ciemniejsza ramka */
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
    max-width: 350px;
    margin: 40px auto 0;
    padding: 20px;
    text-align: left;
    color: #f0f0f0; /* Jasny tekst */
}
.chat-header {
    background-color: #333; /* Ciemny nagłówek */
    color: #f0f0f0; /* Jasny tekst nagłówka */
    padding: 10px;
    margin: -20px -20px 20px -20px;
    font-family: var(--font-serif);
    font-weight: 700;
    text-align: center;
    font-size: 1.2em;
}
#chat-history {
    background-color: #222; /* Tło historii czatu jest ciemniejsze */
    max-height: 250px;
    overflow-y: auto;
    padding-right: 10px;
    margin-bottom: 15px;
    display: flex;
    flex-direction: column;
}
.bot-message, .client-message {
    margin-bottom: 10px;
    padding: 8px 12px;
    border-radius: 15px;
    max-width: 80%;
    font-size: 0.9em;
}
.bot-message {
    background-color: #444; /* Dymek bota - ciemny szary */
    color: #f0f0f0; /* Jasny tekst */
    align-self: flex-start;
    border-bottom-left-radius: 2px;
}
.client-message {
    background-color: #555; /* Dymek klienta - ciemniejszy szary */
    color: #f0f0f0; /* Jasny tekst */
    margin-left: auto;
    text-align: right;
    border-bottom-right-radius: 2px;
}
.chat-options button {
    display: block;
    width: 100%;
    padding: 10px;
    margin-bottom: 8px;
    border: 1px solid #666; /* Szara ramka */
    background-color: #333; /* Ciemne tło przycisku */
    color: #f0f0f0; /* Jasny tekst */
    cursor: pointer;
    transition: all 0.2s;
    font-weight: 700;
}
.chat-options button:hover {
    background-color: #555; /* Ciemniejszy hover */
    color: #fff;
}
#chat-input-area {
    display: flex;
    gap: 5px;
    margin-top: 15px;
}
#chat-input-area input {
    flex-grow: 1;
    padding: 10px;
    border: 1px solid #666; /* Szara ramka */
    background-color: #222; /* Ciemne tło pola */
    color: #f0f0f0; /* Jasny tekst */
}
.bot-message a {
    color: #88BBDD; /* Lekko niebieski link, żeby był widoczny */
    font-weight: 700;
    text-decoration: underline;
    cursor: pointer;
}
#chat-input-area button {
    background-color: #444; /* Ciemny przycisk wysyłki */
    color: #f0f0f0; /* Jasny tekst */
    border: none;
    padding: 10px 15px;
    font-weight: 700;
    cursor: pointer;
    transition: background-color 0.3s;
}
#chat-input-area button:hover {
    background-color: #666;
}
        /* === STYLE DLA KOLEKCJI === */
        .collection-layout {
            display: flex;
            gap: 30px;
            padding-top: 40px;
        }
        /* === NOWE STYLE DLA BANERA === */
        .collection-hero {
width: 100%;
height: 800px; /* Możesz dostosować wysokość */
background-size: cover;
background-position: center 30%; /* Lekkie przesunięcie w górę */
position: relative;
display: flex;
align-items:center;
padding-top: 120px;
box-sizing: border-box;
            text-align: center;
color: white;
margin-bottom: 40px; /* Odstęp od siatki produktów */
   flex-direction: column;
            justify-content: flex-start;        

        }
        .collection-hero h1 {
font-size: 2.8em;
color: white;
font-family: var(--font-serif);
margin: 0 0 10px 0;
font-weight: 900;
 text-align: center; /* <--- DODAJ TĘ LINIĘ */           
 text-transform: uppercase;
          text-shadow: 0px 2px 5px rgba(0, 0, 0, 1), 0px 4px 25px rgba(0, 0, 0, 1);
        }.collection-hero p {
font-size: 1.4em;
color: #EEE;
letter-spacing: 1px;
margin: 0;
text-align: center; /* <--- DODAJ TĘ LINIĘ */
text-shadow: 0px 2px 5px rgba(0, 0, 0, 1), 0px 4px 25px rgba(0, 0, 0, 1);
        }
       /* === GŁÓWNA ZMIANA: TŁO STRONY KOLEKCJI === */
#kolekcja-page {
    background-color: var(--color-background-dark);
    color: var(--color-text-light);
}

/* === ZASTĄP STARE STYLE FILTRÓW === */
#filter-sidebar {
    flex: 0 0 250px;
    padding: 25px;
    background-color: white; /* Ciemniejszy szary niż tło strony */
    border: 1px solid #333;
    border-radius: 8px; /* Zaokrąglenie rogów */
}
#filter-sidebar h4 {
    color: var(--color-accent-gold);
    text-transform: uppercase;
    margin-top: 0;
    margin-bottom: 15px;
    font-size: 1em;
}
.filter-group {
    /* Twój styl akordeonu .filter-group jest OK, nie ruszamy go */
    /* Zostawiamy definicje .filter-group z linii ~738 */
    margin-bottom: 0; /* Upewnij się, że to jest, reszta z akordeonu */
    padding-bottom: 0;
    border-bottom: 1px solid #333; /* ZMIANA: Ciemniejsza linia */
}
.filter-group label {
    display: block;
    margin-bottom: 8px;
    cursor: pointer;
    font-size: 0.95em;
    color: #CCC; /* ZMIANA: Jasno-szary tekst */
    transition: color 0.2s;
}
.filter-group label:hover {
    color: #FFF; /* Jaśniejszy po najechaniu */
}

/* ZMIANA: Dostosuj nagłówek akordeonu do ciemnego tła */
.filter-group-toggle {
    font-family: var(--font-serif);
    font-size: 1.1em !important;
    color: var(--color-text-light) !important; /* ZMIANA: Jasny tekst */
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin: 0;
    padding: 18px 0;
    cursor: pointer;
    position: relative;
    user-select: none;
    transition: color 0.3s;
}
/* ZMIANA: Strzałka musi być jasna */
.filter-group-toggle .arrow {
    position: absolute;
    right: 5px;
    top: 50%;
    transform: translateY(-50%) rotate(45deg);
    width: 8px;
    height: 8px;
    border-bottom: 2px solid var(--color-text-light); /* ZMIANA: Jasna ramka */
    border-right: 2px solid var(--color-text-light); /* ZMIANA: Jasna ramka */
    transition: transform 0.3s, border-color 0.3s;
}


#product-list-wrapper {
    flex-grow: 1;
}

/* === ZASTĄP STARE STYLE SORTOWANIA === */
#sort-options {
     margin-bottom: 20px;
     text-align: right;
}
#sort-options label {
    font-weight: 700;
    margin-right: 10px;
    color: #AAA; /* ZMIANA: Jaśniejszy tekst */
}
#sort-options select {
    padding: 8px 12px;
    border: 1px solid #555; /* Ciemniejsza ramka */
    background-color: #333; /* Ciemne tło */
    color: var(--color-text-light); /* Jasny tekst */
    border-radius: 4px;
}

/* === ZASTĄP STARE STYLE SIATKI PRODUKTÓW === */
#product-grid {
    display: grid;
    /* ZMIANA: Ustawiamy 3 kolumny */
    grid-template-columns: repeat(3, 1fr);
    gap: 30px; /* Zwiększamy odstęp */
}

/* === POPRAWNE STYLE KARTY PRODUKTU (WERSJA OSTATECZNA) === */

/* Główny kontener karty */
.product-card {
    background-color: #222; /* Ciemne tło, jak w mockupie */
    color: var(--color-text-light); /* Jasny tekst */
    text-align: center;
    transition: all 0.3s ease;
    border-radius: 8px; 
    padding: 0; 
    margin: 0; 
    overflow: hidden; /* Aby link ładnie przyciął rogi obrazka */

    /* ZŁOTA RAMKA I POŚWIATA WIDOCZNE ZAWSZE */
    border: 1px solid var(--color-accent-gold); /* Złota ramka */
    box-shadow: 0 0 10px rgba(192, 160, 76, 0.4); /* Subtelna złota poświata */
}

/* Efekt hover na całą kartę */
.product-card:hover {
    transform: translateY(-5px); /* Lekkie uniesienie */
    
    /* MOCNIEJSZA ZŁOTA POŚWIATA */
    box-shadow: 0 5px 20px rgba(192, 160, 76, 0.7); 
}

/* Link, który jest teraz całą kartą */
.product-card-link {
    display: block; /* Ważne, aby link zajął całą przestrzeń */
    text-decoration: none; /* Usuwa podkreślenie */
    color: inherit; /* Dziedziczy kolor tekstu z .product-card */
    padding: 0px;
}

/* Nowy div dla obrazka */
.product-card-image {
    height: 350px;
    width: 100%;
    margin-left: auto;
    margin-right: auto;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
   background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-color: transparent;
   
}

/* Kontener na tekst */
.product-card-info {
    padding: 30px 20px 20px 20px;
}


/* Marka produktu */
.product-card .brand {
    font-family: var(--font-serif);
    color: var(--color-text-light); 
    font-size: 1.3em;                 /* Wracamy do dużego rozmiaru */
    font-weight: 900;
    margin-bottom: 2px; /* Zostawiamy mały margines dla zachowania pozycji */
    text-transform: uppercase;
}

/* Tytuł produktu (H3) */
.product-card h3 {
    font-family: var(--font-sans);
    font-size: 1.1em;
    font-weight: 700;                /* Wracamy do pogrubienia */
    color: var(--color-text-light) !important;
    margin-top: 0;                   /* Zostawiamy margines 0 */
    margin-bottom: 8px;              /* Zostawiamy mały margines */
    text-transform: none;

}

/* Cena produktu */
.product-card .price {
    font-family: var(--font-sans);
    font-size: 1.4em;                /* Wracamy do dużego rozmiaru */
    font-weight: 700;
    color: var(--color-accent-gold);
    margin: 0;                       /* Zostawiamy margines 0 */
}


/* Usuwamy stare style przycisków, bo ich nie ma */
.product-card .btn-add {
   display: none;
}

/* Usuwamy style dla p, bo ich nie ma */
.product-card p {
    display: none;
}

/* === PRZYCISK DODAJ DO KOSZYKA === */
.product-card .btn-add {
    display: block;
    width: 100%;
    padding: 16px;
    background-color: var(--color-text-dark);
    color: var(--color-text-light);
    text-decoration: none;
    text-transform: uppercase;
    font-weight: 700;
    transition: background-color 0.3s;
    cursor: pointer;
    border: none;
    font-family: var(--font-sans);
    font-size: 0.9em;
}

.product-card .btn-add:hover {
    background-color: var(--color-accent-gold);
    color: var(--color-text-dark);
}


        /* === STYLE DLA STRONY KONTA (LOGOWANIE/REJESTRACJA) === */
        #konto-page {
            background-color: var(--color-background-light);
            color: var(--color-text-dark);
            padding-bottom: 0;
        }
        .auth-section {
            padding: 80px 0;
            text-align: center;
        }
        .auth-container {
            display: flex;
            justify-content: center;
            gap: 60px;
            max-width: 1000px;
            margin: 40px auto;
        }
        .auth-form {
            background-color: #F0F0F0;
            padding: 40px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            width: 45%;
            text-align: left;
            transition: all 0.3s;
        }
        .auth-form:hover {
             box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        .auth-form h2 {
            text-align: center;
            color: var(--color-accent-gold);
            margin-bottom: 30px;
            font-size: 1.8em;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 400;
            color: var(--color-text-dark);
            font-size: 0.95em;
        }
        .form-group input, .form-group select, .form-group textarea { /* DODANO TEXTAREA */
            width: 100%;
            padding: 12px;
            border: 1px solid #AAA;
            background-color: white;
            color: var(--color-text-dark);
            font-size: 1em;
            box-sizing: border-box;
            transition: border-color 0.3s;
            font-family: var(--font-sans); /* NOWOŚĆ */
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { /* DODANO TEXTAREA */
            border-color: var(--color-accent-gold);
            outline: none;
            box-shadow: 0 0 5px rgba(192, 160, 76, 0.5);
        }
        .forgot-password {
            font-size: 0.9em;
            text-align: right;
            margin-top: 15px;
        }
        .forgot-password a {
            color: var(--color-text-dark);
            text-decoration: underline;
        }
        .btn-auth {
            display: block;
            width: 100%;
            padding: 14px;
            margin-top: 20px;
            background-color: var(--color-accent-gold);
            color: var(--color-background-dark);
            border: none;
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 1px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        /* === STYLE DLA PANELU UŻYTKOWNIKA === */
        #user-dashboard {
            max-width: 1000px;
            margin: 40px auto;
            padding: 20px;
        }
        .dashboard-header {
            background-color: var(--color-accent-gold);
            color: var(--color-background-dark);
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .dashboard-header h2 {
            margin: 0;
            font-size: 1.8em;
        }
        .dashboard-header button {
            background: var(--color-background-dark);
            color: var(--color-accent-gold);
            border: none;
            padding: 10px 20px;
            text-transform: uppercase;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .dashboard-header button:hover {
            background: #444;
        }
        .dashboard-content {
            display: flex;
            gap: 30px;
            margin-top: 30px;
        }
        .dashboard-nav {
            flex: 0 0 220px;
            background-color: #ECECE4;
            padding: 20px;
        }
        .dashboard-nav a {
            display: block;
            padding: 12px 10px;
            text-decoration: none;
            color: var(--color-text-dark);
            border-bottom: 1px dashed #CCC;
            transition: background-color 0.2s, color 0.2s;
            cursor: pointer;
        }
        .dashboard-nav a:hover, .dashboard-nav a.active {
            background-color: var(--color-accent-gold);
            color: var(--color-background-dark);
            font-weight: 700;
        }
        .dashboard-main {
            flex-grow: 1;
            background-color: #FFFFFF;
            padding: 30px;
            border: 1px solid #EEE;
        }
        .order-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .order-table th, .order-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #EEE;
        }
        .order-table th {
            background-color: #F5F5F5;
            color: var(--color-text-dark);
            font-weight: 700;
            text-transform: uppercase;
            font-size: 0.85em;
        }

        /* === STYLE DLA PANELU ADMINA (OGÓLNE) === */
        #admin-page .container {
            padding-top: 50px;
            padding-bottom: 50px;
        }
        #admin-page .dashboard-content { /* NOWOŚĆ: Dopasowanie do reszty */
             max-width: 1200px;
             margin: 40px auto;
        }
        /* Style dla formularza i listy produktów (w panelu) */
        .admin-layout {
            display: flex;
            gap: 40px;
            align-items: flex-start;
        }
        .admin-form-container {
            flex: 1;
            padding: 30px;
            background-color: #F0F0F0;
            border: 1px solid rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 120px; /* Wysokość nagłówka + margines */
        }
        .admin-list-container {
            flex: 2;
        }
        .admin-product-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
       .admin-product-table th, .admin-product-table td {
    padding: 10px;
    border: 1px solid #DDD;
    text-align: left;
    font-size: 0.9em;
    color: var(--color-text-dark); /* NOWOŚĆ: Ustawia kolor tekstu na czarny/ciemny */
}
        .admin-product-table th {
            background-color: #333;
            color: var(--color-accent-gold);
        }
        .admin-product-table .btn-admin-edit, .admin-product-table .btn-admin-delete {
            padding: 5px 10px;
            border: none;
            cursor: pointer;
            font-size: 0.9em;
            margin-right: 5px;
        }
        .btn-admin-edit {
            background-color: #3498db;
            color: white;
        }
        .btn-admin-delete {
            background-color: #e74c3c;
            color: white;
        }
        .btn-admin-clear {
            background-color: #95a5a6;
            color: #1A1A1A;
            margin-top: 10px;
            padding: 8px;
            border: none;
            cursor: pointer;
            width: 100%;
        }

        /* === NOWE STYLE DLA KART STATYSTYK === */
        .stats-card-container {
            display: flex;
            gap: 20px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }
        .stats-card {
            flex: 1;
            min-width: 200px;
            background-color: #ECECE4;
            padding: 25px;
            border-bottom: 3px solid var(--color-accent-gold);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }
        .stats-card h4 {
            margin: 0 0 10px 0;
            font-size: 1.1em;
            color: #555;
            text-transform: none;
            letter-spacing: 0;
        }
        .stats-card .stat-value {
            font-family: var(--font-serif);
            font-size: 2.5em;
            font-weight: 900;
            color: var(--color-text-dark);
        }

        /* === STYLE DLA STRONY O NAS - SEKACJA DLACZEGO MY === */
        .advantage-section {
    background-color: #111; /* Bardzo ciemne tło */
    padding: 60px 0;
    margin-top: 40px;
    border-top: 3px solid var(--color-accent-gold);
}
/* Poprawka koloru tekstu w tej sekcji */
.advantage-section .container h2,
.advantage-section .container p {
    color: var(--color-text-light) !important; /* Tekst informacyjny na jasny */
}
        .advantage-list {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
            margin-top: 30px;
        }
        .advantage-item {
            background-color: #1A1A1A;
           border: 1px solid rgba(192, 160, 76, 0.2);
            padding: 25px;
            flex: 1 1 calc(33% - 40px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            min-width: 250px;
            text-align: center;
            transition: transform 0.3s;
      color: var(--color-text-light);
        }
        .advantage-item:hover {
             transform: translateY(-5px);
            box-shadow: 0 0 20px var(--color-accent-gold); /* Silniejszy złoty blask przy najechaniu */
        }
        .advantage-item h4 {
           color: var(--color-accent-gold);
            font-size: 1.1em;
            margin-top: 0;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }
        .advantage-item .icon {
            font-size: 2em;
            color: var(--color-accent-gold);
            margin-bottom: 10px;
            display: block;
        }

        /* === STYLE DLA PODSTRON Z TEKSTEM (REGULAMIN, POLITYKA, ZWROTY) === */
        .text-page-content {
            padding: 50px 0 80px 0;
            line-height: 1.8;
            font-size: 1.1em;
            color: var(--color-text-light);
            background-color: var(--color-background-dark);
        }
        .text-page-content h3 {
            color: var(--color-accent-gold);
            margin-top: 40px;
            margin-bottom: 15px;
            font-size: 1.5em;
            letter-spacing: 1px;
            text-transform: none;
        }
        .text-page-content h4 {
            color: var(--color-text-light);
            margin-top: 25px;
            margin-bottom: 10px;
            font-size: 1.2em;
            letter-spacing: 0.5px;
            text-transform: none;
            font-weight: 700;
        }
        .text-page-content p, .text-page-content ul {
            margin-bottom: 20px;
           color: var(--color-text-light);
        }
        .text-page-content ul {
            padding-left: 20px;
            list-style: disc;
        }

        /* === NOWE STYLE DLA KOSZYKA === */
       /* === NOWE I ULEPSZONE STYLE DLA KOSZYKA === */
#koszyk-page .container {
    padding-top: 50px;
    padding-bottom: 80px;
}
.koszyk-layout {
    display: flex;
    gap: 40px;
    flex-wrap: wrap;
}

/* Sekcja z listą produktów (lewa strona) */
#koszyk-lista {
    flex: 2;
    min-width: 300px;
    /* Lista produktów ma pasować do tła strony */
    background-color: transparent; 
    color: var(--color-text-light);
}



/* Pojedynczy Element Produktu na liście */
.koszyk-item {
    display: flex;
    gap: 20px;
    align-items: center;
    border-bottom: 1px solid #333; /* Ciemna linia oddzielająca */
    padding: 20px 0;
}
.koszyk-item-img {
    width: 80px;
    height: 80px;
    background-color: #444; /* Ciemne tło dla kwadratu obrazka (usuwa jasny panel) */
    border: 1px solid #555;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #AAA; /* Kolor "Brak zdjęcia" */
    font-size: 0.8em;
    text-align: center;
}
.koszyk-item-info {
    flex-grow: 1;
}
.koszyk-item-info h4 {
    margin: 0;
    font-size: 1.1em;
    font-family: var(--font-sans);
    text-transform: none;
    letter-spacing: 0;
    color: var(--color-text-light); /* Tekst jasny */
}
.koszyk-item-info .brand {
    font-family: var(--font-serif);
    color: var(--color-accent-gold); /* Marka złota */
    font-weight: 700;
}
/* KROK 5: CENA i PRZYCISK USUWANIA */
.koszyk-item-cena {
    font-size: 1.2em;
    font-weight: 700;
    color: var(--color-accent-gold); /* Cena złotym kolorem */
    min-width: 100px;
    text-align: right;
}
.koszyk-ilosc input {
    width: 50px;
    padding: 5px;
    text-align: center;
    border: 1px solid #555;
    background-color: #383838;
    color: var(--color-text-light);
}
.btn-usun {
    background: none;
    border: none;
    color: #FF7F7F; /* Lepszy, estetyczny czerwony do usuwania */
    font-size: 1.2em;
    cursor: pointer;
    padding: 5px;
}

/* Podsumowanie Sumy Całkowitej */
#koszyk-podsumowanie {
    text-align: right;
    margin-top: 20px;
    border-top: 2px solid var(--color-accent-gold); /* Złota linia dla wyróżnienia */
    padding-top: 20px;
    color: var(--color-text-light);
}
#koszyk-podsumowanie h3 {
    font-size: 1.8em;
    color: var(--color-accent-gold);
    margin: 0;
}
/* Pusty Koszyk */
#pusty-koszyk-info {
    text-align: center;
    padding: 80px 20px;
    background-color: #222; /* Ciemne tło dla komunikatu o pustym koszyku */
    border: 1px dashed #555;
    color: var(--color-text-light);
}
#pusty-koszyk-info .btn-main {
    font-size: 1em;
    padding: 12px 30px;
}
/* Centrowanie przycisków "Do koszyka" / "Szczegóły" na kartach */
.product-card > div:last-of-type {
    justify-content: center;
}
        /* === RESPONSIVE DESIGN (MEDIA QUERIES) === */
        @media (max-width: 1024px) {
            header nav { display: none; }
            .footer-content { flex-wrap: wrap; justify-content: space-around; }
            .footer-links, .footer-contact { flex-basis: 45%; margin-bottom: 30px; }
            .collection-layout { flex-direction: column; }
            #filter-sidebar { flex: 1 1 100%; border-right: none; border-bottom: 1px solid #DDD; }
            #product-grid { grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); }
            .dashboard-content { flex-direction: column; }
            .dashboard-nav { flex: 1 1 100%; }
            .admin-layout { flex-direction: column; }
            .admin-form-container { position: static; }
            #koszyk-formularz { position: static; } /* NOWOŚĆ */
        }

     @media (max-width: 768px) {
    .hero-section { 
        padding: 120px 15px 80px 15px; 
        background-position: 85% center;
    }

    /* === ZMIANA NA 3 KOLUMNY DLA 768PX I MNIEJ === */
    #product-grid {
        grid-template-columns: repeat(3, 1fr) !important;
        gap: 8px !important; 
    }

    .product-card-image {
        height: 160px; /* Zmniejszenie wysokości */
        margin-bottom: 2px;
    }

    .product-card-info {
        padding: 10px 5px 5px 5px; /* Bardzo mały padding */
    }

    /* Zmniejszenie czcionek */
    .product-card .brand, .product-card h3 {
        font-size: 0.75em !important;
        margin-bottom: 2px !important;
    }

    .product-card .price {
        font-size: 0.85em !important;
    }
    /* === KONIEC ZMIANY 768PX === */
    
    .values-section .value-cards { flex-direction: column; gap: 20px; }
    .values-section .card { flex-basis: 100%; padding: 20px; }
    .detail-section .content-2col { flex-direction: column; gap: 30px; }
    .detail-section .image-mock { display: none; }
    .footer-links, .footer-contact { flex-basis: 100%; text-align: center; }
    .footer-links a { display: inline-block; margin: 0 10px 5px 10px; }
    .auth-container { flex-direction: column; gap: 30px; }
    .auth-form { width: 100%; box-sizing: border-box; }
    #pomoc-page .container > div { flex-direction: column; }
    .chatbot-container { max-width: 100%; }
    .advantage-list { flex-direction: column; gap: 20px; }
    .advantage-item { flex: 1 1 100%; }
    .dashboard-header { flex-direction: column; text-align: center; gap: 10px; }
    .stats-card-container { flex-direction: column; }
    /* === POPRAWKI MOBILNE (PRODUKTY I NAGŁÓWEK) === */
    
    /* 1. Zmniejszenie nagłówka na wszystkich podstronach */
    header {
        padding: 12px 0;
    }

    header h1 {
        font-size: 1.9em !important;
    }
}
           
@media (max-width: 480px) {
    /* ... (istniejące style dla .hero-content h1, .btn-main, .mini-footer, menu) ... */
    .hero-content h1 { font-size: 2em; }
    .btn-main { padding: 12px 40px; font-size: 0.9em; }
    .mini-footer { flex-direction: column; text-align: center; }
    .mini-footer p { margin-bottom: 10px; }
    .mini-footer .social-icons { margin: 10px 0; }
    #side-menu.open { width: 100%; }
    #side-menu a { font-size: 16px; }

    /* === NOWA KOREKTA: BANNER KOLEKCJI NA TELEFON === */
    .collection-hero {
        height: 350px; /* ZMNIEJSZENIE WYSOKOŚCI BANNERA */
        /* Upewnienie się, że tekst zaczyna się wyżej */
        padding-top: 50px; 
        margin-bottom: 20px; 
    }

    .collection-hero h1 {
        /* ZMNIEJSZENIE CZCIONKI GŁÓWNEGO NAPISU */
        font-size: 1.8em; 
        letter-spacing: 2px;
    }

    .collection-hero p {
        /* ZMNIEJSZENIE CZCIONKI PODTYTUŁU */
        font-size: 1em; 
        margin-top: 5px;
    }
    /* === KONIEC KOREKTY BANNERA === */

    /* === UKŁAD 3 KOLUMNY (powtórzenie, aby działało na pewno) === */
    #product-grid {
        grid-template-columns: repeat(3, 1fr) !important; 
        gap: 8px !important; 
    }
    .product-card-image {
        height: 160px; 
        margin-bottom: 2px;
    }
    .product-card-info {
        padding: 5px 2px; 
    }
    .product-card .brand, .product-card h3 {
        font-size: 0.75em !important;
        margin-bottom: 2px !important;
    }
    .product-card .price {
        font-size: 0.85em !important;
    }
}
        /* === STYLE DLA ZWIJANYCH GRUP FILTRÓW (AKORDEON) === */

        /* Zastępujemy stare style dla .filter-group */
        .filter-group {
            border-bottom: 1px solid #DDD; /* Linia oddzielająca grupy */
            padding-bottom: 0; /* Resetujemy stary padding */
            margin-bottom: 0; /* Resetujemy stary margin */
        }

        /* Usuwamy stary nagłówek H4, bo teraz mamy nowy, klikalny */
        #filter-sidebar .filter-group > h4:not(.filter-group-toggle) {
            display: none;
        }

        /* Nowy, klikalny nagłówek */
        .filter-group-toggle {
            font-family: var(--font-serif);
            font-size: 1.1em !important;
            color: var(--color-text-dark) !important;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin: 0;
            padding: 18px 0; /* Dajemy padding dla klikalności */
            cursor: pointer;
            position: relative;
            user-select: none; /* Zapobiegamy zaznaczaniu tekstu */
            transition: color 0.3s;
        }

        .filter-group-toggle:hover {
            color: var(--color-accent-gold) !important;
        }

        /* Strzałka */
        .filter-group-toggle .arrow {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%) rotate(45deg); /* Strzałka w dół */
            width: 8px;
            height: 8px;
            border-bottom: 2px solid var(--color-text-dark);
            border-right: 2px solid var(--color-text-dark);
            transition: transform 0.3s, border-color 0.3s;
        }

        .filter-group-toggle:hover .arrow {
            border-color: var(--color-accent-gold);
        }

        /* Kontener z checkboxami (domyślnie zwinięty) */
        .filter-group-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-out, padding 0.4s ease-out;
            padding-top: 0;
            padding-bottom: 0;
        }

        /* --- Style dla AKTYWNEJ (rozwiniętej) grupy --- */
        .filter-group.active .filter-group-toggle {
            color: var(--color-accent-gold) !important;
        }

        .filter-group.active .filter-group-toggle .arrow {
            transform: translateY(-25%) rotate(-135deg); /* Strzałka w górę */
            border-color: var(--color-accent-gold);
        }

        .filter-group.active .filter-group-content {
            max-height: 600px; /* Wystarczająco dużo miejsca na filtry */
            padding-top: 5px;
            padding-bottom: 15px; /* Odstęp na dole po rozwinięciu */
            transition: max-height 0.5s ease-in, padding 0.5s ease-in;
        }
   

    /* Wklej nowy kod CSS TUTAJ, na samym końcu tej sekcji: */

/* === DODATKOWE STYLE DLA KASY (CHECKOUT) === */

.delivery-option label, .payment-option label {
    display: block;
    margin-bottom: 15px;
    font-size: 1.1em;
    cursor: pointer;
}
.delivery-option input[type="radio"], .payment-option input[type="radio"] {
    width: auto !important; 
    margin-right: 10px;
}
    <style>
        /* Dodatkowa animacja pisania */
        .bot-message.typing::after {
            content: '...';
            display: inline-block;
            animation: typing-blink 1s infinite;
        }
        @keyframes typing-blink {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }
    </style>
</head>
<body>

    <div id="side-menu">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
        
        <div id="user-panel-side">
        </div>

        <h3 style="color: var(--color-accent-gold); margin-top: 20px; margin-bottom: 30px;">NAWIGACJA</h3>
        
        <a id="nav-koszyk-side" onclick="closeNav(); showPage('koszyk-page');">Mój Koszyk (<span class="cart-counter">0</span>)</a>
        <a id="nav-kolekcja-side" onclick="closeNav(); showPage('kolekcja-page');">Odkryj Kolekcję</a>
        <a id="nav-onas-side" onclick="closeNav(); showPage('onas-page');">Nasza Misja (O Nas)</a>
        <a id="nav-regulamin-side" onclick="closeNav(); showPage('regulamin-page');">Regulamin i Zasady</a>
        <a id="nav-polityka-side" onclick="closeNav(); showPage('polityka-page');">Polityka Prywatności</a>
        <a id="nav-zwroty-side" onclick="closeNav(); showPage('zwroty-page');">Zwroty i Reklamacje</a>
        <a onclick="closeNav(); showPage('pomoc-page');">Wsparcie i FAQ</a>
        <a id="nav-konto-side" onclick="closeNav(); showPage('konto-page');">Konto Klienta</a>
        
        <div style="margin-top: 50px; font-size: 0.9em; color: rgba(255, 255, 255, 0.5);"><p>Tel: 532 116 720</p><p>E-mail: odoris.pl@gmail.com</p></div>
    </div>

    <div id="landing-page" class="page-section active">
        <div class="hero-section">
            <div class="menu-toggle" onclick="openNav()">&#9776;</div>
            <div class="hero-content">
                <h1><a onclick="showPage('landing-page');"><span class="gold-text">ODORIS</span></a></h1>
                <p class="hero-slogan">Autentyczność. Luksus. Ekskluzywność.</p>
                <p>Twój autoryzowany butik luksusowych perfum. <br>**100% Gwarancji Oryginalności.** **Kultowe Zapachy Świata.**</p>
                
                </div>
        </div>
        
        <div style="text-align: center; position: relative; z-index: 2; margin-top: -90px; padding-bottom: 70px;">
            <a onclick="showPage('kolekcja-page');" class="btn-main">Odkryj Pełną Kolekcję &rarr;</a>
        </div>
        
        <div class="values-section">
            <div class="container">
                <h2 style="color: var(--color-accent-gold); margin-bottom: 20px;">Gwarancja ODORIS</h2>
                <div class="value-cards">
                    <div class="card"><a onclick="showPage('onas-page');" style="color: inherit; text-decoration: none;"><h3>Autentyczność</h3><p>Gwarantujemy 100% oryginalności.</p></a></div>
                    <div class="card"><a onclick="showPage('onas-page');" style="color: inherit; text-decoration: none;"><h3>Kontrolowany Sourcing</h3><p>Bezpośrednia współpraca z oficjalnymi dystrybutorami.</p></a></div>
                    <div class="card"><a onclick="showPage('pomoc-page');" style="color: inherit; text-decoration: none;"><h3>Szybka Realizacja</h3><p>Dyskretna, zabezpieczona wysyłka w 24 godziny.</p></a></div>
                </div>
            </div>
        </div>
        
        <div id="sourcing" class="detail-section">
            <div class="container content-2col">
                <div class="text-content">
                    <h2 style="color: var(--color-accent-gold);">Rygorystyczny Proces Sourcingu</h2>
                    <p style="font-size: 1.1em;">W świecie perfum luksusowych, autentyczność to podstawa...</p>
                    <p>Każdy flakon w naszej ofercie przechodzi wieloetapową weryfikację. Współpracujemy wyłącznie z **autoryzowanymi dystrybutorami** marek niszowych i luksusowych, co pozwala nam eliminować ryzyko produktów z niepewnych źródeł.</p>
                    <p>Nasze magazyny spełniają rygorystyczne normy dotyczące temperatury i wilgotności. Zapachy są chronione przed światłem i wahaniami termicznymi, co **gwarantuje zachowanie ich pierwotnej kompozycji i trwałości** aż do momentu dostawy do klienta.</p>
                    <p style="font-weight: bold; color: var(--color-accent-gold);">Kupujesz pewność. <a onclick="showPage('onas-page');" style="color: var(--color-text-light); text-decoration: underline;">Czytaj więcej o nas.</a></p>
                </div>
                <div class="image-mock" style="background-image: url('https://picsum.photos/id/21/500/400'); background-size: cover; background-position: center;"></div>
            </div>
        </div>
        
        <div id="paleta" class="detail-section">
            <div class="container content-2col" style="flex-direction: row-reverse;">
                <div class="text-content">
                    <h2 style="color: var(--color-accent-gold);">Ekskluzywna Kuratela Zapachów</h2>
                    <p style="font-size: 1.1em;">Nie jesteśmy hurtownią. Jesteśmy butikiem z wyselekcjonowaną ofertą...</p>
                    <p>Nasza kolekcja to rezultat głębokiej wiedzy i pasji do perfumiarstwa. Wybieramy wyłącznie te kompozycje, które wyróżniają się **unikalnym składem, historią i mistrzowskim wykonaniem**. Wierzymy, że luksus to doświadczenie, nie tylko cena.</p>
                    <p>W **ODORIS** znajdziesz rzadkie, trudno dostępne edycje oraz absolutne bestsellery niszowych domów perfumeryjnych. Jeśli szukasz czegoś wyjątkowego, co podkreśli Twój styl, nasza kuratela jest dla Ciebie.</p>
                    <p style="font-weight: bold; color: var(--color-accent-gold);">Najlepsze z najlepszych – gotowe do odkrycia. <a onclick="showPage('kolekcja-page');" style="color: var(--color-text-light); text-decoration: underline;">Przejdź do katalogu.</a></p>
                </div>
                <div class="image-mock" style="background-image: url('https://picsum.photos/id/40/500/400'); background-size: cover; background-position: center;"></div>
            </div>
        </div>
        
        <div class="mini-footer container">
            <p>&copy; 2025 ODORIS. Wszelkie prawa zastrzeżone.</p>
            <div class="social-icons">
                <span>Znajdziesz nas na:</span>
                <a href="#" target="_blank" title="Facebook">&#9733; FB</a>
                <a href="#" target="_blank" title="Instagram">&#9733; IG</a>
                <a href="#" target="_blank" title="TikTok">&#9733; TikTok</a>
            </div>
            <a onclick="showPage('pomoc-page');">Potrzebujesz Pomocy? &rarr;</a>
        </div>
    </div>

    <div id="kolekcja-page" class="page-section">
    <header>
        <div class="container">
            <h1 style="font-size: 2.5em; margin: 0; font-weight: 900;"><a onclick="showPage('landing-page');"><span class="gold-text">ODORIS</span></a></h1>
            <nav id="nav-kolekcja-header">
                <a id="link-koszyk-kolekcja" onclick="showPage('koszyk-page');">Koszyk (<span class="cart-counter">0</span>)</a>
                <a id="link-kolekcja" onclick="showPage('kolekcja-page');">Kolekcja</a>
                <a id="link-onas-kolekcja" onclick="showPage('onas-page');">O Nas</a>
                <a id="link-regulamin-kolekcja" onclick="showPage('regulamin-page');">Regulamin</a>
                <a id="link-polityka-kolekcja" onclick="showPage('polityka-page');">Polityka</a>
                <a id="link-zwroty-kolekcja" onclick="showPage('zwroty-page');">Zwroty</a>
                <a id="link-pomoc-kolekcja" onclick="showPage('pomoc-page');">Pomoc</a>
                <a id="link-konto-kolekcja" onclick="showPage('konto-page');">Konto</a>
            </nav>
            <div class="menu-toggle" onclick="openNav()">&#9776;</div>
        </div>
    </header>

 <section class="collection-hero" style="background-image: linear-gradient(to bottom, transparent 80%, var(--color-background-dark) 100%), url('tlo-baner.png.PNG');">
     <h1>Odkryj Naszą Kolekcję Zapachów</h1>
     <p>Selekcja najbardziej pożądanych zapachów świata.</p>
</section>
    <section id="kolekcja" class="collection-section container">
        
        <div class="collection-layout">
                <div id="filter-sidebar">
                    <h4>FILTRUJ WYNIKI</h4>

                    <div class="filter-group"> <h4 class="filter-group-toggle">
                            Marka <span class="arrow"></span>
                        </h4>
                        <div class="filter-group-content">
                            <label><input type="checkbox" data-filter="brand" value="Creed" name="filter_brand" id="filter_creed"> Creed</label>
                            <label><input type="checkbox" data-filter="brand" value="Parfums de Marly" name="filter_brand" id="filter_pdm"> Parfums de Marly</label>
                            <label><input type="checkbox" data-filter="brand" value="Tom Ford" name="filter_brand" id="filter_tf"> Tom Ford</label>
                            <label><input type="checkbox" data-filter="brand" value="Frederic Malle" name="filter_brand" id="filter_fm"> Frederic Malle</label>
                            <label><input type="checkbox" data-filter="brand" value="Kilian" name="filter_brand" id="filter_kilian"> Kilian</label>
                        </div>
                    </div>

                    <div class="filter-group "> <h4 class="filter-group-toggle">
                            Kategoria <span class="arrow"></span>
                        </h4>
                        <div class="filter-group-content">
                            <label><input type="checkbox" data-filter="category" value="Męskie" name="filter_category" id="filter_cat_meskie"> Męskie</label>
                            <label><input type="checkbox" data-filter="category" value="Damskie" name="filter_category" id="filter_cat_damskie"> Damskie</label>
                            <label><input type="checkbox" data-filter="category" value="Unisex" name="filter_category" id="filter_cat_unisex"> Unisex</label>
                        </div>
                    </div>

                </div>
                
                <div id="product-list-wrapper">
                    <div id="sort-options">
                        <label for="sort-by">Sortuj według:</label>
                        <select id="sort-by" onchange="applyFilters()">
                            <option value="default">Domyślne</option>
                            <option value="price-asc">Cena rosnąco</option>
                            <option value="price-desc">Cena malejąco</option>
                        </select>
                    </div>
                    
                    <div id="product-grid">
                        <p id="no-products" style="text-align: center; display: none;">Brak produktów spełniających kryteria.</p>
                    </div>
                </div>
            </div>
        </section>
        <footer id="kolekcja-stopka"></footer>
    </div>
    
    <div id="product-page" class="page-section">
        <header>
            <div class="container">
                <h1 style="font-size: 2.5em; margin: 0; font-weight: 900;"><a onclick="showPage('landing-page');"><span class="gold-text">ODORIS</span></a></h1>
                <nav>
                    <a onclick="showPage('kolekcja-page')">Powrót do kolekcji</a>
                </nav>
                <div class="menu-toggle" onclick="openNav()">&#9776;</div>
            </div>
        </header>

        <section class="container" style="padding-top:40px; padding-bottom:80px;">
            <div style="display:flex; gap:40px; flex-wrap:wrap; align-items:flex-start;">
                <div style="display:flex; flex-direction:column; gap:10px;">
                  <div id="detail-image" style="flex:1; min-width:260px; min-height:320px; 
     /* ZMIANA: Ciemne tło, złota ramka */
     background-color:var(--color-background-dark); 
     border:1px solid var(--color-accent-gold); 
     background-size:cover; 
     background-position:center;
     /* DODANIE: Zaokrąglenie narożników */
     border-radius: 8px;">
</div>
                    <div id="detail-thumbnails" style="display:flex; gap:8px; margin-top:8px; flex-wrap:wrap;"></div>
                </div>
                <div style="flex:2; min-width:260px;">
                    <div style="margin-bottom:10px;"><span id="detail-brand" class="brand"></span></div>
                    <h2 id="detail-name" style="margin-top:0;"></h2>
                    <div class="price" id="detail-price" style="margin-bottom:15px;"></div>
                   <p id="detail-description" style="margin-top:20px; color:white; line-height:1.6; font-size: 0.9em;"></p>

                    <h4 style="margin-top:20px; color:var(--color-accent-gold);">Specyfikacja</h4>
                    <table id="detail-specs" style="width:100%; border-collapse:collapse; margin-top:10px;">
                    </table>

                    <div style="margin-top:20px; display:flex; gap:10px; flex-wrap:wrap;">
                        <button class="btn-main" onclick="addToCartFromDetail()">Dodaj do koszyka</button>
                        <button class="btn-main" style="background:#333; color:#fff;" onclick="showPage('kolekcja-page')">Powrót</button>
                        <button id="detail-edit-btn" class="btn-admin-edit" style="display:none; align-self:flex-start;" onclick="editProductFromDetail()">Edytuj (Admin)</button>
                    </div>
                </div>
            </div>
        </section>
        <footer></footer>
    </div>

    <div id="onas-page" class="page-section">
        <header>
            <div class="container">
                <h1 style="font-size: 2.5em; margin: 0; font-weight: 900;"><a onclick="showPage('landing-page');"><span class="gold-text">ODORIS</span></a></h1>
                <nav id="nav-onas-header">
                    <a id="link-koszyk-onas" onclick="showPage('koszyk-page');">Koszyk (<span class="cart-counter">0</span>)</a>
                    <a id="link-kolekcja-onas" onclick="showPage('kolekcja-page');">Kolekcja</a>
                    <a id="link-onas" onclick="showPage('onas-page');">O Nas</a>
                    <a id="link-regulamin-onas" onclick="showPage('regulamin-page');">Regulamin</a>
                    <a id="link-polityka-onas" onclick="showPage('polityka-page');">Polityka</a>
                    <a id="link-zwroty-onas" onclick="showPage('zwroty-page');">Zwroty</a>
                    <a id="link-pomoc-onas" onclick="showPage('pomoc-page');">Pomoc</a>
                    <a id="link-konto-onas" onclick="showPage('konto-page');">Konto</a>
                </nav>
                <div class="menu-toggle" onclick="openNav()">&#9776;</div>
            </div>
        </header>

        <section class="about-content container">
            <h2 style="margin-bottom: 20px; text-align: center;"><span class="gold-text">NASZA</span> FILOZOFIA I MISJA</h2>
            <p style="font-size: 1.2em; text-align: center; max-width: 800px; margin: 0 auto 50px;">Jesteśmy dedykowanym butikiem, stworzonym z pasji do autentycznej, niszowej perfumerii. Nasza misja to transparentność i gwarancja luksusu.</p>
            
            <h3>Działalność ODORIS</h3>
            <p>**ODORIS** to platforma powstała w celu dostarczania klientom w Polsce wyłącznie **100% oryginalnych perfum luksusowych** w najkrótszym łańcuchu dostaw. Działamy jako wyspecjalizowany butik online, koncentrujący się na autentyczności, globalnym sourcingu i eksperckiej selekcji. Obejmujemy **Warmińsko-Mazurskie (Kętrzyn)** jako naszą bazę operacyjną, skąd realizujemy wysyłki na całą Polskę.</p>
            
            <div class="advantage-section">
                <div class="container" style="max-width: 1000px;">
                    <h2 style="text-align: center; color: var(--color-text-dark); margin-bottom: 40px;"><span class="gold-text">DLACZEGO</span> ODORIS?</h2>
                    <p style="text-align: center; color: #666; font-size: 1.1em;">Nasze cztery kluczowe filary, które odróżniają nas od standardowej drogerii.</p>
                    <div class="advantage-list">
                        
                        <div class="advantage-item">
                            <span class="icon">&#10003;</span>
                            <h4>Gwarancja 100% Oryginalności</h4>
                            <p>Współpracujemy tylko z autoryzowanymi dystrybutorami. Każdy flakon to potwierdzona autentyczność.</p>
                        </div>
                        <div class="advantage-item">
                            <span class="icon">&#9733;</span>
                            <h4>Ekskluzywna Selekcja Niszowa</h4>
                            <p>Zamiast tysięcy pozycji, oferujemy kuratelę najlepszych i najrzadszych zapachów świata.</p>
                        </div>
                        <div class="advantage-item">
                            <span class="icon">&#9888;</span>
                            <h4>Rygorystyczny Sourcing</h4>
                            <p>Kontrola pochodzenia i warunków przechowywania eliminuje wahania jakości i chroni kompozycję.</p>
                        </div>
                        <div class="advantage-item">
                            <span class="icon">&#9992;</span>
                            <h4>Dyskretna Dostawa w 24h</h4>
                            <p>Paczki są starannie zabezpieczone i wysyłane z naszej siedziby w Kętrzynie w 24 godziny.</p>
                        </div>
                    </div>
                </div>
           </div>

            <h3>Jak Powstała Działalność: Historia Autentyczności</h3>
            <p>Pomysł na **ODORIS** zrodził się z frustracji dostępnością niezweryfikowanych produktów na rynku. Zamiast akceptować szarą strefę, zdecydowaliśmy się stworzyć transparentną platformę, która daje absolutną pewność oryginalności. Nasza działalność opiera się na **współpracy bezpośrednio z autoryzowanymi dystrybutorami** i audytach pochodzenia. Eliminujemy ryzyko podróbek i gwarantujemy najwyższą jakość przechowywania, co ma kluczowe znaczenie dla trwałości i kompozycji zapachu.</p>
        </section>
        <footer id="onas-stopka"></footer>
    </div>

    <div id="pomoc-page" class="page-section">
        <header>
            <div class="container">
                <h1 style="font-size: 2.5em; margin: 0; font-weight: 900;"><a onclick="showPage('landing-page');"><span class="gold-text">ODORIS</span></a></h1>
                <nav id="nav-pomoc-header">
                    <a id="link-koszyk-pomoc" onclick="showPage('koszyk-page');">Koszyk (<span class="cart-counter">0</span>)</a>
                    <a id="link-kolekcja-pomoc" onclick="showPage('kolekcja-page');">Kolekcja</a>
                    <a id="link-onas-pomoc" onclick="showPage('onas-page');">O Nas</a>
                    <a id="link-regulamin-pomoc" onclick="showPage('regulamin-page');">Regulamin</a>
                    <a id="link-polityka-pomoc" onclick="showPage('polityka-page');">Polityka</a>
                    <a id="link-zwroty-pomoc" onclick="showPage('zwroty-page');">Zwroty</a>
                    <a id="link-pomoc" onclick="showPage('pomoc-page');">Pomoc</a>
                    <a id="link-konto-pomoc" onclick="showPage('konto-page');">Konto</a>
                </nav>
                <div class="menu-toggle" onclick="openNav()">&#9776;</div>
            </div>
        </header>
        
        <section class="container" style="padding-top: 50px; padding-bottom: 50px;">
            <h2 style="margin-bottom: 40px; text-align: center;"><span class="gold-text">WSPARCIE</span> I POMOC</h2>
            <div style="display: flex; gap: 40px; flex-wrap: wrap; align-items: flex-start;">
                
                <div style="flex: 1; min-width: 300px;">
                    <h3><span class="gold-text">Bot</span> Wsparcia ODORIS</h3>
                    <p>Nasz automatyczny asystent pomoże Ci znaleźć odpowiedzi na najczęściej zadawane pytania. Możesz też wpisać swoje pytanie poniżej:</p>
                    <div class="chatbot-container">
                        <div class="chat-header">Asystent ODORIS</div>
                        <div id="chat-history">
                            <div class="bot-message">Witaj! Jestem Bot Wsparcia. Jak mogę Ci pomóc?</div>
                        </div>
                        <div id="chat-options" class="chat-options">
                        </div>
                        <div id="chat-input-area">
                            <input type="text" id="user-input" placeholder="Wpisz: Gwarancja, Dostawa, Zwroty..." data-ph-index="0">
                            <button onclick="sendChatMessage()">Wyślij</button>
                        </div>
                    </div>
                </div>
                
                <div id="contact-section" style="flex: 1; min-width: 300px;">
                    <h3><span class="gold-text">Szczegóły</span> Kontaktu</h3>
                    <p>Jeśli Bot nie odpowiedział na Twoje pytania, skontaktuj się z nami bezpośrednio:</p>
                    <div class="contact-box" style="margin-top: 20px;">
                        <h4>Kontakt Telefoniczny</h4>
                        <strong class="gold-text">Numer Telefonu:</strong><p><a href="tel:532116720">532 116 720</a></p>
                    </div>
                    <div class="contact-box" style="margin-top: 20px;">
                        <h4>Kontakt E-mail</h4>
                        <strong class="gold-text">Adres E-mail:</strong><p><a href="mailto:odoris.pl@gmail.com">odoris.pl@gmail.com</a></p>
                    </div>
                    <div class="contact-box" style="margin-top: 20px;">
                        <h4>Adres Siedziby</h4>
                        <strong class="gold-text">Lokalizacja:</strong><p>ul. Perfumowa 1, 11-400 Kętrzyn</p>
                    </div>
                </div>
            </div>
        </section>
        
        <footer id="pomoc-stopka"></footer>
    </div>
    
    <div id="konto-page" class="page-section">
        <header>
            <div class="container">
                <h1 style="font-size: 2.5em; margin: 0; font-weight: 900;"><a onclick="showPage('landing-page');"><span class="gold-text">ODORIS</span></a></h1>
                <nav id="nav-konto-header">
                    <a id="link-koszyk-konto" onclick="showPage('koszyk-page');">Koszyk (<span class="cart-counter">0</span>)</a>
                    <a id="link-kolekcja-konto" onclick="showPage('kolekcja-page');">Kolekcja</a>
                    <a id="link-onas-konto" onclick="showPage('onas-page');">O Nas</a>
                    <a id="link-regulamin-konto" onclick="showPage('regulamin-page');">Regulamin</a>
                    <a id="link-polityka-konto" onclick="showPage('polityka-page');">Polityka</a>
                    <a id="link-zwroty-konto" onclick="showPage('zwroty-page');">Zwroty</a>
                    <a id="link-pomoc-konto" onclick="showPage('pomoc-page');">Pomoc</a>
                    <a id="link-konto" onclick="showPage('konto-page');">Konto</a>
                </nav>
                <div class="menu-toggle" onclick="openNav()">&#9776;</div>
            </div>
        </header>

        <section class="auth-section container" id="konto-content">
        </section>

        <footer id="konto-stopka"></footer>
    </div>
    
    <div id="regulamin-page" class="page-section">
        <header>
            <div class="container">
                <h1 style="font-size: 2.5em; margin: 0; font-weight: 900;"><a onclick="showPage('landing-page');"><span class="gold-text">ODORIS</span></a></h1>
                <nav id="nav-regulamin-header">
                    <a id="link-koszyk-regulamin" onclick="showPage('koszyk-page');">Koszyk (<span class="cart-counter">0</span>)</a>
                    <a id="link-kolekcja-regulamin" onclick="showPage('kolekcja-page');">Kolekcja</a>
                    <a id="link-onas-regulamin" onclick="showPage('onas-page');">O Nas</a>
                    <a id="link-regulamin" onclick="showPage('regulamin-page');">Regulamin</a>
                    <a id="link-polityka-regulamin" onclick="showPage('polityka-page');">Polityka</a>
                    <a id="link-zwroty-regulamin" onclick="showPage('zwroty-page');">Zwroty</a>
                    <a id="link-pomoc-regulamin" onclick="showPage('pomoc-page');">Pomoc</a>
                    <a id="link-konto-regulamin" onclick="showPage('konto-page');">Konto</a>
                </nav>
               <div class="menu-toggle" onclick="openNav()">&#9776;</div>
            </div>
        </header>
        <section class="container text-page-content">
            <h2 style="margin-bottom: 20px; text-align: center;"><span class="gold-text">REGULAMIN</span> SPRZEDAŻY I ZASADY SKLEPU</h2>
            <p style="text-align: center; color: #666; font-size: 1.1em; max-width: 900px; margin: 0 auto 50px;">Aktualna wersja obowiązująca od 01.01.2025 r.</p>
            <h3>§ 1. Postanowienia Ogólne</h3>
            <p>Niniejszy regulamin określa zasady dokonywania zakupów w sklepie internetowym **ODORIS**, dostępnym pod adresem odoris.pl. Sprzedawcą jest [Nazwa firmy, NIP, adres - do uzupełnienia].</p>
            <ul>
                <li>Definicje: Użyte w regulaminie terminy oznaczają: Klient, Sprzedawca, Sklep, Towar (perfumy luksusowe).</li>
                <li>Zakres: Regulamin dotyczy umów sprzedaży Towarów zawieranych na odległość.</li>
            </ul>
            <h3>§ 2. Zamówienia i Ceny</h3>
            <h4>2.1. Składanie Zamówień</h4>
            <p>Zamówienia można składać 24 godziny na dobę poprzez witrynę Sklepu. Do złożenia zamówienia wymagana jest rejestracja konta Klienta lub złożenie zamówienia bez rejestracji.</p>
            <ul>
                <li>Potwierdzenie: Po złożeniu zamówienia Klient otrzymuje e-mail z podsumowaniem i potwierdzeniem przyjęcia zamówienia do realizacji.</li>
                <li>Płatność: Klient zobowiązany jest dokonać płatności w terminie 3 dni roboczych od dnia złożenia zamówienia.</li>
            </ul>
            
            <h4>2.2. Ceny Produktów</h4>
            <p>Wszystkie ceny podane w Sklepie są cenami brutto (zawierają podatek VAT) i są wyrażone w polskich złotych (PLN).</p>
            <ul>
                <li>Cena wiążąca: Wiążąca dla Klienta i Sprzedawcy jest cena Towaru obowiązująca w chwili złożenia zamówienia.</li>
                <li>Koszty Dostawy: Koszty dostawy są doliczane do ceny Towaru i są widoczne w koszyku przed finalizacją transakcji.</li>
            </ul>
            <h3>§ 3. Dostawa i Czas Realizacji</h3>
            <p>Dostawa Towarów jest ograniczona do terytorium Rzeczypospolitej Polskiej.</p>
            <ul>
                <li>Czas Realizacji: Zamówienia są realizowane w ciągu **24 godzin** od momentu zaksięgowania pełnej płatności.</li>
                <li>Metody Dostawy: Przesyłki realizowane są za pośrednictwem kuriera (DPD/Inpost) lub Paczkomatów.</li>
                <li>Odbiór Przesyłki: W momencie odbioru Towaru Klient powinien sprawdzić stan przesyłki. W przypadku uszkodzenia należy sporządzić protokół szkody.</li>
            </ul>
            <h3>§ 4. Gwarancja Oryginalności i Jakość</h3>
            <p>Sprzedawca gwarantuje, że wszystkie oferowane Towary są **w 100% oryginalne** i pochodzą z autoryzowanego źródła dystrybucji.</p>
            <ul>
                <li>Sourcing: Towary są przechowywane w kontrolowanych warunkach, co zapewnia ich niezmienioną kompozycję i jakość.</li>
                <li>Brak Wymiany: Perfumy są produktem higienicznym i chemicznym; Sprzedawca nie akceptuje zwrotów Towaru z naruszonym fabrycznym opakowaniem.</li>
            </ul>
            <h3>§ 5. Prawo Odstąpienia od Umowy (Zwroty)</h3>
            <p>Klient będący konsumentem ma prawo odstąpić od umowy sprzedaży w terminie 14 dni bez podania jakiejkolwiek przyczyny.</p>
            <ul>
                <li>Wyjątek: Prawo odstąpienia od umowy nie przysługuje w odniesieniu do Towaru dostarczanego w zapieczętowanym opakowaniu, jeżeli opakowanie to zostało otwarte po dostarczeniu (Art. 38 pkt 5 ustawy o prawach konsumenta).</li>
                <li>Procedura: Aby skorzystać z prawa odstąpienia, należy poinformować Sprzedawcę pisemnie przed upływem 14 dni i odesłać nieużywany Towar w nienaruszonym stanie.</li>
            </ul>
        </section>
        <footer id="regulamin-stopka"></footer>
    </div>

    <div id="polityka-page" class="page-section">
        <header>
            <div class="container">
                <h1 style="font-size: 2.5em; margin: 0; font-weight: 900;"><a onclick="showPage('landing-page');"><span class="gold-text">ODORIS</span></a></h1>
                <nav id="nav-polityka-header">
                    <a id="link-koszyk-polityka" onclick="showPage('koszyk-page');">Koszyk (<span class="cart-counter">0</span>)</a>
                    <a id="link-kolekcja-polityka" onclick="showPage('kolekcja-page');">Kolekcja</a>
                    <a id="link-onas-polityka" onclick="showPage('onas-page');">O Nas</a>
                    <a id="link-regulamin-polityka" onclick="showPage('regulamin-page');">Regulamin</a>
                    <a id="link-polityka" onclick="showPage('polityka-page');">Polityka</a>
                    <a id="link-zwroty-polityka" onclick="showPage('zwroty-page');">Zwroty</a>
                    <a id="link-pomoc-polityka" onclick="showPage('pomoc-page');">Pomoc</a>
                    <a id="link-konto-polityka" onclick="showPage('konto-page');">Konto</a>
                </nav>
                <div class="menu-toggle" onclick="openNav()">&#9776;</div>
            </div>
        </header>
        <section class="container text-page-content">
            <h2 style="margin-bottom: 20px; text-align: center;"><span class="gold-text">POLITYKA</span> PRYWATNOŚCI</h2>
            <p style="text-align: center; color: #666; font-size: 1.1em; max-width: 900px; margin: 0 auto 50px;">Ochrona Twoich danych jest dla nas priorytetem. Niniejsza Polityka reguluje zasady przetwarzania danych osobowych.</p>
            <h3>§ 1. Administrator Danych Osobowych</h3>
            <p>Administratorem Twoich danych osobowych jest [Nazwa firmy, Adres Siedziby - do uzupełnienia], kontakt możliwy poprzez e-mail: odoris.pl@gmail.com.</p>
            <h3>§ 2. Cel i Podstawy Przetwarzania Danych</h3>
            <p>Twoje dane osobowe (imię, nazwisko, adres e-mail, adres dostawy, numer telefonu) są przetwarzane w celu:</p>
            <ul>
                <li>**Realizacji zamówień** (podstawa: niezbędność do wykonania umowy Art. 6 ust. 1 lit. b RODO).</li>
                <li>**Obsługi konta Klienta** (podstawa: zgoda na przetwarzanie Art. 6 ust. 1 lit. a RODO).</li>
               
                <li>**Marketingu bezpośredniego** (podstawa: prawnie uzasadniony interes Administratora Art. 6 ust. 1 lit. f RODO, w przypadku wcześniej wyrażonej zgody).</li>
            </ul>
            <h3>§ 3. Odbiorcy Danych</h3>
            <p>Twoje dane mogą być udostępniane podmiotom, z którymi współpracujemy, w celu realizacji zamówienia, w tym:</p>
            <ul>
                <li>Firmom kurierskim i operatorom pocztowym.</li>
                <li>Podmiotom obsługującym płatności elektroniczne.</li>
                <li>Podmiotom świadczącym usługi księgowe i prawne.</li>
            </ul>
            <h3>§ 4. Prawa Osoby, Której Dane Dotyczą</h3>
            <p>Przysługuje Ci prawo do:</p>
            <ul>
                <li>Dostępu do swoich danych.</li>
                <li>Sprostowania, usunięcia lub ograniczenia przetwarzania danych.</li>
                <li>Wniesienia sprzeciwu wobec przetwarzania.</li>
                <li>Przenoszenia danych.</li>
                <li>Wniesienia skargi do organu nadzorczego (Prezesa UODO).</li>
            </ul>
            
            <p>Wycofanie zgody na przetwarzanie danych nie ma wpływu na zgodność z prawem przetwarzania, którego dokonano na podstawie zgody przed jej wycofaniem.</p>
        </section>
        <footer id="polityka-stopka"></footer>
    </div>

    <div id="zwroty-page" class="page-section">
        <header>
            <div class="container">
                <h1 style="font-size: 2.5em; margin: 0; font-weight: 900;"><a onclick="showPage('landing-page');"><span class="gold-text">ODORIS</span></a></h1>
                <nav id="nav-zwroty-header">
                    <a id="link-koszyk-zwroty" onclick="showPage('koszyk-page');">Koszyk (<span class="cart-counter">0</span>)</a>
                   <a id="link-kolekcja-zwroty" onclick="showPage('kolekcja-page');">Kolekcja</a>
                    <a id="link-onas-zwroty" onclick="showPage('onas-page');">O Nas</a>
                    <a id="link-regulamin-zwroty" onclick="showPage('regulamin-page');">Regulamin</a>
                    <a id="link-polityka-zwroty" onclick="showPage('polityka-page');">Polityka</a>
                    <a id="link-zwroty" onclick="showPage('zwroty-page');">Zwroty</a>
                    <a id="link-pomoc-zwroty" onclick="showPage('pomoc-page');">Pomoc</a>
                    <a id="link-konto-zwroty" onclick="showPage('konto-page');">Konto</a>
                </nav>
                <div class="menu-toggle" onclick="openNav()">&#9776;</div>
            </div>
        </header>
        <section class="container text-page-content">
            <h2 style="margin-bottom: 20px; text-align: center;"><span class="gold-text">ZWROTY</span> I REKLAMACJE</h2>
            <p style="text-align: center; color: #666; font-size: 1.1em; max-width: 900px; margin: 0 auto 50px;">Szczegółowe informacje dotyczące odstąpienia od umowy i procedur reklamacyjnych.</p>
            <h3>§ 1. Prawo Odstąpienia od Umowy (Zwroty)</h3>
            <p>Jako konsument masz prawo odstąpić od umowy zakupu bez podawania przyczyny w terminie 14 dni od dnia otrzymania przesyłki.</p>
            
            <h4>1.1. Warunki Zwrotu Produktów Higienicznych</h4>
            <p>Zgodnie z Art. 38 pkt 5 ustawy o prawach konsumenta, **perfumy są towarem dostarczanym w zapieczętowanym opakowaniu** i stanowią produkt higieniczny. Prawo odstąpienia od umowy **nie przysługuje**, jeżeli opakowanie fabryczne (folia, plomba, zabezpieczenie) zostało naruszone lub usunięte.</p>
            <ul>
                <li>Zwracany Towar musi być nieużywany i znajdować się w stanie nienaruszonym (fabrycznie zapakowany).</li>
                <li>Zwrot pieniędzy następuje w terminie 14 dni od otrzymania oświadczenia o odstąpieniu, pod warunkiem zwrotu nienaruszonego towaru.</li>
           </ul>
            <h3>§ 2. Procedura Reklamacyjna (Wady Produktu)</h3>
            <p>Reklamacje z tytułu wad produktu (np. uszkodzony atomizer, wada butelki) są rozpatrywane na podstawie przepisów o rękojmi.</p>
            <h4>2.1. Zgłoszenie Reklamacji</h4>
           <p>W celu złożenia reklamacji prosimy o kontakt e-mailowy na adres **odoris.pl@gmail.com** z załączeniem:</p>
            <ul>
                <li>Dowodu zakupu (paragon lub faktura).</li>
                <li>Dokładnego opisu wady i okoliczności jej powstania.</li>
                <li>Zdjęć lub filmu ilustrującego wadę.</li>
            </ul>
            <h4>2.2. Rozpatrzenie i Termin</h4>
           <p>Reklamacja zostanie rozpatrzona w terminie 14 dni od daty jej otrzymania. O wyniku postępowania Klient zostanie poinformowany drogą mailową.</p>
            
            <p style="margin-top: 40px; font-weight: bold;">Adres do zwrotów i reklamacji: ODORIS, ul. Perfumowa 1, 11-400 Kętrzyn.</p>
        </section>
        <footer id="zwroty-stopka"></footer>
    </div>

    <div id="admin-page" class="page-section">
        <header>
            <div class="container">
                <h1 style="font-size: 2.5em; margin: 0; font-weight: 900;"><a onclick="showPage('landing-page');"><span class="gold-text">ODORIS</span></a></h1>
                <nav id="nav-admin-header">
                    <a onclick="showPage('kolekcja-page');">Podgląd sklepu</a>
                    <a onclick="logoutUser(); showPage('landing-page');">Wyloguj Admina</a>
                </nav>
                <div class="menu-toggle" onclick="openNav()">&#9776;</div>
            </div>
        </header>
        
        <section id="admin-content" class="container">
       </section>

        <footer id="admin-stopka"></footer>
    </div>

    <div id="koszyk-page" class="page-section">
        <header>
            <div class="container">
                <h1 style="font-size: 2.5em; margin: 0; font-weight: 900;"><a onclick="showPage('landing-page');"><span class="gold-text">ODORIS</span></a></h1>
                <nav id="nav-koszyk-header">
                    <a id="link-koszyk" onclick="showPage('koszyk-page');">Koszyk (<span class="cart-counter">0</span>)</a>
                    <a id="link-kolekcja-koszyk" onclick="showPage('kolekcja-page');">Kolekcja</a>
                    <a id="link-onas-koszyk" onclick="showPage('onas-page');">O Nas</a>
                    <a id="link-regulamin-koszyk" onclick="showPage('regulamin-page');">Regulamin</a>
                    <a id="link-pomoc-koszyk" onclick="showPage('pomoc-page');">Pomoc</a>
                    <a id="link-konto-koszyk" onclick="showPage('konto-page');">Konto</a>
               </nav>
                <div class="menu-toggle" onclick="openNav()">&#9776;</div>
            </div>
        </header>
        
        <section class="container">
            <h2 style="margin-bottom: 40px; text-align: center;">TWÓJ <span class="gold-text">KOSZYK</span></h2>
            
            <div class="koszyk-layout">
                <div id="koszyk-lista">
                </div>
                
                <div id="koszyk-formularz-container">
                </div>
            </div>
        </section>
        
        <footer id="koszyk-stopka"></footer>
   </div>
<div id="checkout-page" class="page-section">
    <header>
        <div class="container">
            <h1 style="font-size: 2.5em; margin: 0; font-weight: 900;"><a onclick="showPage('landing-page');"><span class="gold-text">ODORIS</span></a></h1>
            <nav id="nav-checkout-header">
                <a id="link-koszyk-checkout" onclick="showPage('koszyk-page');">&larr; Powrót do koszyka</a>
                <a id="link-kolekcja-checkout" onclick="showPage('kolekcja-page');">Kolekcja</a>
                <a id="link-pomoc-checkout" onclick="showPage('pomoc-page');">Pomoc</a>
            </nav>
            <div class="menu-toggle" onclick="openNav()">&#9776;</div>
        </div>
    </header>
    
    <section class="container" style="padding-top: 50px; padding-bottom: 80px;">
        <h2 style="margin-bottom: 40px; text-align: center;">FINALIZACJA <span class="gold-text">ZAMÓWIENIA</span></h2>
        
        <div class="checkout-layout" style="display: flex; gap: 40px; flex-wrap: wrap; justify-content: center;">
            
            <div id="checkout-form-container" style="flex: 2; min-width: 300px;">
                <h3 style="color: var(--color-accent-gold); margin-top: 0;">1. Dane do Wysyłki</h3>
                <form id="checkout-form" onsubmit="handleOrderSubmit(event); return false;" class="auth-form" style="background-color: #282828; color: var(--color-text-light); box-shadow: none; width: 100%; padding: 30px;">
                    
                    <div class="form-group">
                        <label for="order-imie">Imię i Nazwisko</label>
                        <input type="text" id="order-imie" required placeholder="Jan Kowalski">
                    </div>
                    <div class="form-group">
                        <label for="order-email">Adres E-mail</label>
                        <input type="email" id="order-email" required placeholder="jan.kowalski@email.com">
                    </div>
                    <div class="form-group">
                        <label for="order-phone">Numer Telefonu</label>
                        <input type="tel" id="order-phone" required placeholder="123456789">
                    </div>
                    <div class="form-group">
                        <label for="order-adres">Adres (Ulica, nr domu/mieszkania, Kod pocztowy, Miasto)</label>
                        <textarea id="order-adres" rows="3" required placeholder="ul. Przykładowa 1/1, 00-001 Miasto"></textarea>
                    </div>

                    <h3 style="color: var(--color-accent-gold); margin-top: 40px;">2. Wybór Dostawy</h3>
                    
                    <div class="form-group delivery-option">
                        <label><input type="radio" name="delivery-method" value="Kurier DPD (15.00 PLN)" data-cost="15.00" required checked> Kurier DPD (15.00 PLN)</label>
                    </div>
                    <div class="form-group delivery-option">
                        <label><input type="radio" name="delivery-method" value="Paczkomat InPost (12.00 PLN)" data-cost="12.00" required> Paczkomat InPost (12.00 PLN)</label>
                        <small style="display:block; color:#999; margin-left:25px;">(Wybór automatu po kliknięciu "Złóż zamówienie")</small>
                    </div>
                    <div class="form-group delivery-option">
                        <label><input type="radio" name="delivery-method" value="Odbiór Osobisty (0.00 PLN)" data-cost="0.00" required> Odbiór Osobisty - Kętrzyn (0.00 PLN)</label>
                    </div>

                    <h3 style="color: var(--color-accent-gold); margin-top: 40px;">3. Metoda Płatności</h3>

                    <div class="form-group payment-option">
                        <label><input type="radio" name="payment-method" value="Przelew bankowy" required checked> Przelew bankowy (płatność manualna)</label>
                    </div>
                    <div class="form-group payment-option">
                        <label><input type="radio" name="payment-method" value="Płatność przy odbiorze (5.00 PLN)" data-cost="5.00" required> Płatność przy odbiorze (Pobranie +5.00 PLN)</label>
                    </div>
                    <div class="form-group payment-option">
                        <label><input type="radio" name="payment-method" value="Płatności online (Przelewy24/BLIK)" required> Szybki przelew online (symulacja)</label>
                    </div>

                    <div class="form-group" style="margin-top: 30px;">
                        <label for="order-uwagi">Uwagi do zamówienia (opcjonalnie)</label>
                        <textarea id="order-uwagi" rows="2" placeholder="Napisz, jeśli masz specjalne instrukcje..."></textarea>
                    </div>

                    <div class="form-group" style="margin-top: 30px; text-align: center;">
                        <label>
                            <input type="checkbox" id="accept-regulamin" required style="width: auto; margin-right: 5px;"> 
                            Akceptuję <a onclick="showPage('regulamin-page');" style="color: var(--color-accent-gold); cursor: pointer;">Regulamin Sklepu</a> i <a onclick="showPage('polityka-page');" style="color: var(--color-accent-gold); cursor: pointer;">Politykę Prywatności</a>.
                        </label>
                    </div>
                    
                    <button type="submit" class="btn-auth" style="margin-top: 30px; font-size: 1.2em;">
                        ZŁÓŻ ZAMÓWIENIE Z OBOWIĄZKIEM ZAPŁATY
                    </button>
                </form>
            </div>
            
            <div id="checkout-summary-container" style="flex: 1; min-width: 300px; position: sticky; top: 120px;">
                <div style="background-color: #282828; padding: 30px; color: var(--color-text-light);">
                    <h3 style="color: var(--color-accent-gold); margin-top: 0; text-align: center;">PODSUMOWANIE</h3>
                    <div id="checkout-summary-items">
                        </div>
                    <div id="checkout-final-total" style="border-top: 2px solid var(--color-accent-gold); padding-top: 15px; margin-top: 15px;">
                        <p style="margin: 0; font-size: 1.2em;">SUMA DO ZAPŁATY:</p>
                        <h3 id="final-price" style="margin: 5px 0 0 0; font-size: 2em; color: var(--color-accent-gold);">0.00 PLN</h3>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <footer id="checkout-stopka"></footer>
</div>

    <template id="auth-template">
        <h2 style="color: var(--color-text-dark); margin-bottom: 20px; font-size: 2.2em;">Zarządzaj swoim <span class="gold-text">Kontem</span></h2>
        <p style="color: #666; max-width: 700px; margin: 0 auto 50px;">Zaloguj się, aby śledzić zamówienia, zarządzać ulubionymi zapachami i korzystać ze specjalnych ofert.</p>
        
        <div class="auth-container">
            <div class="auth-form">
                <h2>Logowanie</h2>
                <form onsubmit="loginUser(); return false;">
                    <div class="form-group">
                        <label for="login-email">Adres E-mail</label>
                        <input type="email" id="login-email" value="login-email" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Hasło</label>
                        <input type="password" id="login-password"  required>
                    </div>
                    <button type="submit" class="btn-auth">ZALOGUJ SIĘ</button>
                    <div class="forgot-password"><a href="#">Nie pamiętasz hasła?</a></div>
                </form>
            </div>
            
            <div class="auth-form">
               <h2>Nowe Konto</h2>
                <form onsubmit="registerUser(); return false;">
                    <div class="form-group">
                        <label for="register-username">Nazwa użytkownika (login)</label>
                        <input type="text" id="register-username" required>
                   </div>
                    <div class="form-group">
                        <label for="register-email">Adres E-mail</label>
                        <input type="email" id="register-email" required>
                    </div>
                    <div class="form-group">
                        <label for="register-password">Hasło</label>
                        <input type="password" id="register-password" required>
                    </div>
                    <button typeS="submit" class="btn-auth">UTWÓRZ KONTO</button>
                    <p style="margin-top: 20px; font-size: 0.8em; color: #666; text-align: center;">Tworząc konto, akceptujesz <a onclick="showPage('regulamin-page');" style="color: var(--color-accent-gold); cursor: pointer;">Regulamin</a>.</p>
                </form>
            </div>
        </div>
    </template>

    <template id="dashboard-template">
        <div id="user-dashboard">
            <div class="dashboard-header">
                <h2>Witaj, <span id="user-name-display" class="gold-text">Kliencie!</span></h2>
                <button onclick="logoutUser();">Wyloguj &rarr;</button>
            </div>
            <div class="dashboard-content">
                <div class="dashboard-nav">
                    <a id="nav-orders" class="active" onclick="showDashboardContent('orders')">Twoje Zamówienia</a>
                    <a id="nav-address" onclick="showDashboardContent('address')">Adresy Dostawy</a>
                    <a id="nav-profile" onclick="showDashboardContent('profile')">Edytuj Profil</a>
                   <a onclick="showPage('kolekcja-page')">Przejdź do Sklepu</a>
                </div>
                <div id="dashboard-main" class="dashboard-main">
                </div>
            </div>
        </div>
    </template>

    <template id="admin-template">
        <div id="admin-dashboard-container"> <div class="dashboard-header">
                <h2>Panel <span class="gold-text">Administratora</span></h2>
                <button onclick="logoutUser();">Wyloguj &rarr;</button>
            </div>
            <div class="dashboard-content">
                <div class="dashboard-nav">
                   <a id="nav-admin-stats" class="active" onclick="showAdminContent('stats')">Statystyki</a>
                    <a id="nav-admin-products" onclick="showAdminContent('products')">Zarządzaj Produktami</a>
                    <a onclick="showPage('kolekcja-page')">Podgląd Sklepu</a>
                </div>
                <div id="admin-main" class="dashboard-main">
                </div>
            </div>
        </div>
    </template>

    <template id="admin-stats-template">
        <h3>Przegląd Sklepu</h3>
        <div class="stats-card-container">
            
            <div class="stats-card">
                <h4>Łączny przychód (z bazy)</h4>
                <div id="stats-total-revenue" class="stat-value">...</div>
           </div>
            <div class="stats-card">
                <h4>Liczba zamówień (z bazy)</h4>
                <div id="stats-total-orders" class="stat-value">...</div>
            </div>
        </div>

        <h3 style="margin-top: 40px;">Wszystkie Złożone Zamówienia</h3>
        <table class="order-table">
            <thead>
                <tr>
                    <th>ID Zamówienia</th>
                    <th>Data</th>
                    <th>Email Klienta</th>
                    <th>Telefon</th> 
                    <th>Dostawa</th> 
                    <th>Płatność</th>                     
                    <th>Status</th>
                    <th>Suma</th>
                </tr>
            </thead>
            <tbody id="admin-orders-list-body">
            </tbody>
        </table>
    </template>

    <template id="admin-products-template">
        <h2 style="text-align: center; margin-bottom: 40px;">ZARZĄDZANIE <span class="gold-text">PRODUKTAMI</span></h2>
        
        <div class="admin-layout">
            <div id="admin-form-container" class="admin-form-container">
                <h3 id="admin-form-title" style="color: var(--color-accent-gold); text-align: center;">Dodaj Nowy Produkt</h3>
                
                <form id="admin-product-form" onsubmit="handleAdminFormSubmit(event)">
                    <input type="hidden" id="admin-product-id">
                    
                    <div class="form-group">
                       <label for="admin-brand">Marka</label>
                        <input type="text" id="admin-brand" required>
                    </div>
                    <div class="form-group">
                        <label for="admin-name">Nazwa Produktu (np. Aventus (EDP 100ml))</label>
                        <input type="text" id="admin-name" required>
                    </div>
                    <div class="form-group">
                       <label for="admin-price">Cena (tylko liczba, np. 1250)</label>
                        <input type="number" id="admin-price" required>
                    </div>
                    <div class="form-group">
                       <label for="admin-category">Kategoria</label>
                        <select id="admin-category" required>
                            <option value="Męskie">Męskie</option>
                            <option value="Damskie">Damskie</option>
                            <option value="Unisex">Unisex</option>
                       </select>
                    </div>

                    <div class="form-group">
                       <label for="admin-description">Opis produktu</label>
                        <textarea id="admin-description" rows="4"></textarea>
                    </div>

                    <div class="form-group">
                       <label>Specyfikacja (klucz → wartość)</label>
                        <div id="admin-specs-list"></div>
                        <button type="button" class="btn-admin-clear" onclick="addSpecField()">Dodaj pole specyfikacji</button>
                    </div>

                    <div class="form-group">
                        <label for="admin-images">Zdjęcia produktu (max 5)</label>
                        <input type="file" id="admin-images" accept="image/*" multiple>
                        <div id="admin-image-previews" style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;"></div>
                        <small style="color:#666;">Wgrywane obrazy zapisywane są lokalnie w przeglądarce jako data URL (localStorage).</small>
                    </div>
                    
                    <button type="submit" class="btn-auth">Zapisz Produkt</button>
                    <button type="button" class="btn-admin-clear" onclick="clearAdminForm()">Wyczyść formularz</button>
                </form>
            </div>

            <div class="admin-list-container">
               <h3>Obecna Baza Produktów</h3>
                <table class="admin-product-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Marka</th>
                            <th>Nazwa</th>
                            <th>Cena</th>
                            <th>Kategoria</th>
                            <th>Akcje</th>
                       </tr>
                    </thead>
                    <tbody id="admin-product-list-body">
                    </tbody>
                </table>
            </div>
        </div>
    </template>
   <script>
        
    // === KONFIGURACJA SUPABASE (TWOJE KLUCZE SĄ JUŻ W ŚRODKU) ===
     // UWAGA: Klucz anon jest widoczny publicznie. Upewnij się, że masz włączone RLS (Row Level Security) w tabelach!
     const SUPABASE_URL = 'https://dtgwyrvbqpefrcjdnqqv.supabase.co';
     const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR0Z3d5cnZicXBlZnJjamRucXF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIwMTU3MjIsImV4cCI6MjA3NzU5MTcyMn0.WObj9HRon0hYM9m9JC-ty1bE1DXxzwQ7RmkfValxJCs';

     // Inicjalizuj klienta
     let supabase = null;
     if (SUPABASE_URL && SUPABASE_ANON_KEY) {
         try {
             supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
         } catch (e) {
             console.error("Błąd inicjalizacji Supabase:", e);
         }
     } else {
         console.warn("Chatbot: Nie skonfigurowano Supabase. Funkcje bazy danych nie będą działać.");
     }

     // === STAN CHATBOTA ===
     let chatState = 'IDLE'; // Stan rozmowy: IDLE, AWAITING_ORDER_NUMBER

     // === KLUCZ PRZECHOWYWANIA DANYCH W LOCALSTORAGE ===
     const LS_PRODUCTS_KEY = 'pf_products';
     const LS_USERS_KEY = 'pf_users';
     const LS_SESSION_KEY = 'pf_currentUser';
     const LS_ORDERS_KEY = 'pf_orders';

     // ### KROK 3: DODANIE NOWEGO KLUCZA DLA KOSZYKA ###
     const LS_CART_KEY = 'pf_cart';
         
         

         /* Baza zamówień (teraz pusta, czeka na prawdziwe dane) */
         const initialOrdersData = [];

         
        

         // ===============================================
         // === FUNKCJE SUPABASE (SYNCHRONIZACJA Z ADMINEM) ===
         // ===============================================

         // --- NOWA FUNKCJA: Synchronizacja produktów z Supabase (Zapis/Aktualizacja) ---
         async function syncProductsToSupabase(products) {
             if (!supabase) {
                 console.warn("Supabase nie jest skonfigurowane, nie można zapisać produktów w bazie.");
                 return;
             }
             
          try {
                 // ZMIANA: Mapujemy obiekty z {id: ...} na {ID: ...} przed wysłaniem do Supabase
             const productsForSupabase = products.map(p => {
                 const { id, ...rest } = p; // Dzielimy obiekt: 'id' i reszta pól
                 return {
                     ID: id, // Zmieniamy nazwę klucza 'id' na 'ID'
                     ...rest // Dodajemy resztę pól (brand, name, price etc.)
                 };
             });

                 // Upsert: wstawia, jeśli nie istnieje; aktualizuje, jeśli ID już istnieje
                 const { error } = await supabase
                     .from('produkty') // <-- UŻYJ NAZWY SWOJEJ TABELI PRODUKTÓW
                     .upsert(productsForSupabase, { onConflict: 'ID' }); // <-- ZMIANA
                 
                 if (error) throw error;
                 console.log("Produkty pomyślnie zsynchronizowane z Supabase.");
             } catch (e) {
                 console.error("Błąd zapisu do Supabase:", e.message);
                 // W Admin Panelu w tym miejscu często pojawia się alert z błędem RLS
                 alert("Błąd zapisu w bazie danych Supabase. Sprawdź, czy jesteś zalogowany i czy polityki RLS są poprawne.");
             }
         }

         // --- NOWA FUNKCJA: Synchronizacja usunięcia produktu z Supabase ---
         async function deleteProductFromSupabase(productId) {
             if (!supabase || !isCurrentUserAdmin()) return;
             
             try {
                const { error } = await supabase
                     .from('produkty') // <-- UŻYJ NAZWY SWOJEJ TABELI PRODUKTÓW
                     .delete()
                     .eq('ID', productId);
                     
                 if (error) throw error;
                 console.log(`Produkt ${productId} usunięty z Supabase.`);
             } catch (e) {
                 console.error("Błąd usuwania z Supabase:", e.message);
                 alert("Błąd usuwania z bazy Supabase. Spróbuj ponownie.");
             }
         }

         // ===============================================
         // === LOGIKA UWIERZYTELNIANIA (KLIENT I ADMIN) ===
         // ===============================================

         /** Pobiera aktualnie zalogowanego użytkownika z localStorage */
         function getCurrentUser() {
             const user = localStorage.getItem(LS_SESSION_KEY);
             return user ? JSON.parse(user) : null;
         }

         /** Sprawdza, czy użytkownik jest zalogowany */
         function getIsLoggedIn() {
             return getCurrentUser() !== null;
         
         }
        /** Sprawdza, czy zalogowany użytkownik jest adminem */
         function isCurrentUserAdmin() {
             const user = getCurrentUser();
             return user && user.isAdmin === true;
         }

         /** Pobiera nazwę zalogowanego użytkownika */
         function getUserName() {
             const user = getCurrentUser();
             return user ? user.username : "Kliencie";
         }

        /** Rejestruje nowego użytkownika w Supabase (z potwierdzeniem email) */
         async function registerUser() {
             const username = document.getElementById('register-username').value;
             const email = document.getElementById('register-email').value;
             const password = document.getElementById('register-password').value;

             if (!username || !email || !password) {
                 alert('Proszę wypełnić wszystkie pola.');
                 return;
             }
             if (email.toLowerCase() === 'odoris.pl@gmail.com') {
                 alert('Ten adres e-mail jest zarezerwowany.');
                 return;
             }

             try {
                 // Krok 1: Zarejestruj użytkownika w Supabase Auth
                 const { data, error } = await supabase.auth.signUp({
                     email: email,
                     password: password,
                     options: {
                         data: { 
                             username: username 
                         }
                     }
                 });

                 if (error) throw error; // Rzuć błąd, jeśli wystąpił

                 // Krok 2: Pokaż wiadomość o konieczności potwierdzenia
                 if (data.user) {
                     alert('Rejestracja pomyślna! Sprawdź swoją skrzynkę mailową (również folder SPAM) i kliknij w link, aby aktywować konto. Dopiero wtedy będziesz mógł się zalogować.');
                     // Wyczyść formularz
                     document.getElementById('register-username').value = '';
                     document.getElementById('register-email').value = '';
                     document.getElementById('register-password').value = '';
                 }

             } catch (error) {
                 console.error('Błąd rejestracji:', error.message);
                 alert('Błąd rejestracji: ' + error.message);
             }
         }

         /** Loguje użytkownika (klienta lub admina) przez Supabase */
         async function loginUser() { 
             const email = document.getElementById('login-email').value;
             const password = document.getElementById('login-password').value;

             // Logika dla Admina zostaje (bo już używa Supabase)
             if (email.toLowerCase() === 'odoris.pl@gmail.com' && password === 'admin123') {
                 if (!supabase) {
                     alert('Błąd: Supabase nie jest skonfigurowane. Zalogowanie Admina niemożliwe.');
                     return;
                 }
                 
                 const { error } = await supabase.auth.signInWithPassword({
                     email: email,
                     password: password,
                 });
                 
                 if (error) {
                     alert(`Błąd logowania Admina: ${error.message}.`);
                     return;
                 }
                 
                 const currentUser = { 
                     email: 'odoris.pl@gmail.com', 
                     username: 'Administrator', 
                     isAdmin: true 
                 };
                 localStorage.setItem(LS_SESSION_KEY, JSON.stringify(currentUser));
                 
                 updateSideMenu();
                 showPage('admin-page');
                 return;
             }

             // === ZMIANA: ŚCIEŻKA DLA ZWYKŁEGO UŻYTKOWNIKA ===
             try {
                 // Używamy tej samej funkcji co admin, ale dla zwykłego usera
                 const { data, error } = await supabase.auth.signInWithPassword({
                     email: email,
                     password: password,
                 });

                 if (error) throw error; // Rzuć błąd, aby złapał go 'catch'

                 if (data.user) {
                     // Sukces: Zalogowano użytkownika
                     const currentUser = {
                         email: data.user.email,
                         // Pobierz 'username' zapisane podczas rejestracji
                         username: data.user.user_metadata.username || data.user.email.split('@')[0], 
                         isAdmin: false,
                         id: data.user.id
                     };
                     localStorage.setItem(LS_SESSION_KEY, JSON.stringify(currentUser));
                     
                     updateSideMenu();
                     renderKontoPage(); // Pokaż panel konta
                 }
             } catch (error) {
                 console.error('Błąd logowania:', error.message);
                 alert('Nieprawidłowy e-mail lub hasło.');
                 localStorage.removeItem(LS_SESSION_KEY);
                 updateSideMenu();
             }
         }
        /** Wylogowuje użytkownika z Supabase i lokalnie */
         async function logoutUser() { // ZMIANA: Dodano async
             // Krok 1: Wyloguj z Supabase
             const { error } = await supabase.auth.signOut();
             if (error) {
                 console.error('Błąd wylogowania z Supabase:', error.message);
             }

             // Krok 2: Wyloguj lokalnie (jak wcześniej)
             localStorage.removeItem(LS_SESSION_KEY);
             updateSideMenu();
             
             // Reszta kodu UI zostaje bez zmian
             const activePage = document.querySelector('.page-section.active');
             if (activePage && (activePage.id === 'konto-page' || activePage.id === 'admin-page')) {
                 showPage('landing-page');
             } else if (activePage && activePage.id === 'konto-page') {
                 renderKontoPage(); // Pokaż formularz logowania
             }
         }

         /** Aktualizuje boczny panel (#side-menu) na podstawie stanu logowania */
         function updateSideMenu() {
             const userPanel = document.getElementById('user-panel-side');
             const kontoLink = document.getElementById('nav-konto-side');
             const user = getCurrentUser();

             let panelHTML = '';

             if (user) {
                 // Użytkownik ZALOGOWANY
                 panelHTML = `
                     <div style="padding: 15px 32px; color: #AAA; font-size: 1.1em; text-align: left; padding-bottom: 5px;">
                         Witaj, <strong style="color: var(--color-accent-gold); display: block; font-size: 1.2em;">${user.username}</strong>
                     </div>
                 `;

                 if (user.isAdmin) {
                     // ZALOGOWANY JAKO ADMIN
                     panelHTML += `
                         <a id="nav-admin-panel-side" onclick="closeNav(); showPage('admin-page');" style="color: #e74c3c; font-weight: 700;">PANEL ADMINA</a>
                         <a id="nav-zamowienia-side" onclick="closeNav(); showPage('kolekcja-page');">Podgląd sklepu</a>
                     `;
                 } else {
                     // ZALOGOWANY JAKO KLIENT
                     panelHTML += `
                         <a id="nav-zamowienia-side" onclick="closeNav(); showPage('konto-page'); showDashboardContent('orders');">Moje Zamówienia</a>
                     `;
                 }
                 
                 panelHTML += `
                     <a id="nav-wyloguj-side" onclick="closeNav(); logoutUser();">Wyloguj się</a>
                     <hr style="border-color: rgba(255,255,255,0.1); margin: 15px 30px;">
                 `;
                 kontoLink.textContent = 'Panel Konta';

             } else {
                 // Użytkownik Wylogowany
                 kontoLink.textContent = 'Konto Klienta';
             }

             userPanel.innerHTML = panelHTML;
         }


         // ===============================================
         // === ZARZĄDZANIE BAZAMI (Produkty i Zamówienia) ===
         // ===============================================

         /** Jednorazowa inicjalizacja bazy produktów (pobieranie z Supabase) */
         async function initializeProductStorage() {

             // 1. Spróbuj pobrać produkty z Supabase (jeśli Supabase jest dostępne)
             if (supabase) {
                 try {
                     console.log("Pobieranie produktów z Supabase...");
                     const { data, error } = await supabase
                         .from('produkty')
                         .select('*');

                     if (error) throw error;
                     
                     if (data && data.length > 0) {
                         // Sukces: zapisz do LocalStorage (jako cache) i użyj
                         localStorage.setItem(LS_PRODUCTS_KEY, JSON.stringify(data));
                         console.log(`Pobrano ${data.length} produktów z Supabase.`);
                         return;
                     } else {
                         console.warn("Brak danych w Supabase. Używam domyślnych danych startowych.");
                     }
                 } catch (e) {
                     console.error("Błąd pobierania z Supabase, używam LocalStorage:", e.message);
                 }
             }
             
             // 2. Jeśli Supabase nie działa lub nie ma danych, użyj LocalStorage/inicjalizuj
             const products = localStorage.getItem(LS_PRODUCTS_KEY);
             if (!products) {
                 // Inicjalizacja LocalStorage startowymi danymi tylko raz
                 localStorage.setItem(LS_PRODUCTS_KEY, JSON.stringify(initialProductsData));
                 if (supabase) {
                      // Jeśli Supabase jest dostępne, spróbuj zapisać startowe dane do Supabase
                      await syncProductsToSupabase(initialProductsData);
                }
             }
         }

         /** NOWOŚĆ: Jednorazowa inicjalizacja bazy zamówień w localStorage */
         function initializeOrderStorage() {
             const orders = localStorage.getItem(LS_ORDERS_KEY);
             if (!orders) {
                 localStorage.setItem(LS_ORDERS_KEY, JSON.stringify(initialOrdersData));
             }
         }

        /** Pobiera wszystkie produkty z bazy localStorage i zapewnia domyślne pola */
         function getProductsFromStorage() {
             const raw = JSON.parse(localStorage.getItem(LS_PRODUCTS_KEY) || '[]');
             
            // Poprawka: Mapujemy 'p.ID' (z Supabase) do pola 'id' (dla JavaScriptu)
             return raw.map(p => ({
                 id: p.ID, // <-- ZMIANA: Pobieramy z kolumny 'ID' z Supabase
                 brand: p.brand || '',
                 name: p.name || '',
                 price: typeof p.price === 'number' ? p.price : parseFloat(p.price) || 0,
                 category: p.category || '',
                 description: p.description || 'Brak opisu produktu.',
                 specs: Array.isArray(p.specs) ? p.specs : [],
                 images: Array.isArray(p.images) ? p.images : []
             }));
         }

         /** NOWOŚĆ: Pobiera wszystkie zamówienia z bazy localStorage */
         function getOrdersFromStorage() {
             return JSON.parse(localStorage.getItem(LS_ORDERS_KEY) || '[]');
         }

         /** Zapisuje całą tablicę produktów do bazy localStorage (i synchronizuje z Supabase) */
         function saveProductsToStorage(products) {
             localStorage.setItem(LS_PRODUCTS_KEY, JSON.stringify(products));

             // Jeśli użytkownik jest zalogowany jako Admin, spróbuj zapisać zmiany do Supabase
             if (isCurrentUserAdmin()) {
                 syncProductsToSupabase(products);
             }
         }
         
         // ===============================================
         // === LOGIKA KOSZYKA (NOWOŚĆ) ===
         // ===============================================

         /** Pobiera koszyk z localStorage */
         function getCart() {
             return JSON.parse(localStorage.getItem(LS_CART_KEY) || '[]');
         }

         /** Zapisuje koszyk w localStorage */
         function saveCart(cartData) {
             localStorage.setItem(LS_CART_KEY, JSON.stringify(cartData));
             updateCartCounters(); // Aktualizuj liczniki przy każdym zapisie
         }

         /** Aktualizuje wszystkie liczniki koszyka na stronie */
         function updateCartCounters() {
             const cart = getCart();
             let totalItems = 0;
             if (Array.isArray(cart)) {
                 totalItems = cart.reduce((sum, item) => sum + (item.quantity || 0), 0);
             }
             
             const counters = document.querySelectorAll('.cart-counter');
             counters.forEach(counter => {
                 counter.textContent = totalItems;
             });
         }

         /** Dodaje produkt do koszyka */
         function addToCart(productId) {
             const products = getProductsFromStorage();
             // === POPRAWKA BŁĘDU TYPÓW (Liczba vs Tekst) ===
             const productToAdd = products.find(p => String(p.id) === String(productId));
             
             if (!productToAdd) {
                 console.error('Nie znaleziono produktu o ID:', productId);
                 alert('Błąd: Nie można dodać do koszyka, nie znaleziono produktu.');
                 return;
             }

             let cart = getCart();
             if (!Array.isArray(cart)) { // Zabezpieczenie przed uszkodzonymi danymi
                  cart = [];
             }
             
             // === POPRAWKA BŁĘDU TYPÓW (Liczba vs Tekst) ===
             const existingItem = cart.find(item => String(item.id) === String(productId));

             if (existingItem) {
                 existingItem.quantity = (existingItem.quantity || 0) + 1;
             } else {
                 cart.push({
                     id: productToAdd.id,
                     name: productToAdd.name,
                     brand: productToAdd.brand,
                     price: productToAdd.price,
                     quantity: 1
                 });
             }

             saveCart(cart);
             alert(`"${productToAdd.name}" został dodany do koszyka!`);
         }
         
         /** Zmienia ilość produktu w koszyku */
         function updateCartQuantity(productId, newQuantity) {
             let cart = getCart();
             if (!Array.isArray(cart)) cart = [];
             
             const itemToUpdate = cart.find(item => String(item.id) === String(productId));
             
             if (itemToUpdate) {
                 const quantity = parseInt(newQuantity, 10);
                 if (quantity > 0) {
                     itemToUpdate.quantity = quantity;
                 } else {
                     // Jeśli ilość to 0 lub mniej, usuń przedmiot
                     cart = cart.filter(item => String(item.id) !== String(productId));
                 }
                 saveCart(cart);
                 renderCartPage(); // Przerenderuj koszyk
             }
         }

         /** Usuwa produkt z koszyka */
         function removeFromCart(productId) {
             if (!confirm('Czy na pewno chcesz usunąć ten produkt z koszyka?')) {
                 return;
             }
             let cart = getCart();
             if (!Array.isArray(cart)) cart = [];
             
             cart = cart.filter(item => String(item.id) !== String(productId));
             saveCart(cart);
             renderCartPage(); // Przerenderuj koszyk
         }

         /** Renderuje zawartość strony koszyka */
        function renderCartPage() {
    const listContainer = document.getElementById('koszyk-lista');
    const formContainer = document.getElementById('koszyk-formularz-container');
    
    if (!listContainer || !formContainer) return;

    const cart = getCart();
    // Pobieramy całą listę produktów, aby móc dopasować obrazek
    const allProducts = getProductsFromStorage();
    
    if (!Array.isArray(cart) || cart.length === 0) {
        // ... (kod dla pustego koszyka bez zmian) ...
    } else {
        // RENDERUJ LISTĘ PRODUKTÓW I FORMULARZ
        let listHTML = '';
        let sumaCalkowita = 0;

        cart.forEach(item => {
            const itemTotal = (item.price || 0) * (item.quantity || 0);
            sumaCalkowita += itemTotal;
            
            // Znajdź pełny obiekt produktu, aby pobrać obrazek
            const productDetail = allProducts.find(p => String(p.id) === String(item.id));
            const imageUrl = (productDetail && productDetail.images && productDetail.images.length > 0) ? productDetail.images[0] : '';

            // Używamy tagu <img> w elemencie .koszyk-item-img 
            listHTML += `
                <div class="koszyk-item">
                    <div class="koszyk-item-img">
                        ${imageUrl ? `<img src="${imageUrl}" style="width:100%; height:100%; object-fit:cover;" alt="${item.name}">` : 'Brak zdjęcia'}
                    </div>
                    <div class="koszyk-item-info">
                        <span class="brand">${item.brand}</span>
                        <h4>${item.name}</h4>
                        <p>Ilość: 
                            <input type="number" value="${item.quantity}" min="1" 
                                    onchange="updateCartQuantity('${item.id}', this.value)" 
                                    class="koszyk-ilosc">
                        </p>
                    </div>
                    <span class="koszyk-item-cena">${itemTotal.toFixed(2)} PLN</span>
                    <button class="btn-usun" title="Usuń produkt" onclick="removeFromCart('${item.id}')">&times;</button>
                </div>
            `;
        });
        
       /* NOWY BLOK DLA KOSZYKA: */
        // ZMIANA: Nagłówek i Suma Całkowita w lewym panelu
        listHTML += `
            <div id="koszyk-podsumowanie">
                <p style="margin: 0; font-size: 1.1em;">Suma całkowita:</p>
                <h3>${sumaCalkowita.toFixed(2)} PLN</h3>
            </div>
        `;
        listContainer.innerHTML = listHTML;

        // NOWY BLOK: RENDERUJ TYLKO PRZYCISK PRZEKIEROWUJĄCY DO STRONY KASY
        formContainer.innerHTML = `
            <form id="koszyk-formularz" onsubmit="showPage('checkout-page'); return false;">
                <h3 style="color: var(--color-accent-gold); text-align: center; margin-top: 0;">PODSUMOWANIE KOSZYKA</h3>
                
                <div style="font-size: 1.1em; padding: 10px 0; border-bottom: 1px solid #333; margin-bottom: 20px; text-align: center; color: var(--color-text-light);">
                    Wartość produktów: <strong class="gold-text">${sumaCalkowita.toFixed(2)} PLN</strong>
                </div>

                <p style="color: #AAA; font-size: 0.9em;">Przejdź do kasy, aby wybrać sposób dostawy, płatności i złożyć zamówienie:</p>

                <button type="submit" class="btn-auth" style="margin-top: 20px;">
                    PRZEJDŹ DO KASY &rarr;
                </button>
                
                <p style="font-size: 0.8em; color: #666; text-align: center; margin-top: 15px;">
                    Cena dostawy i pobrania zostanie doliczona na stronie kasy.
                </p>
            </form>
        `;
    }
}
         
       // ===============================================
// === LOGIKA KASY (CHECKOUT) ===
// ===============================================

/** Oblicza całkowitą cenę, uwzględniając koszty dostawy i pobrania */
function calculateFinalPrice(cartSubtotal) {
    let deliveryCost = 0;
    let paymentFee = 0;
    
    const deliveryEl = document.querySelector('input[name="delivery-method"]:checked');
    if (deliveryEl) {
        deliveryCost = parseFloat(deliveryEl.dataset.cost) || 0;
    }

    const paymentEl = document.querySelector('input[name="payment-method"]:checked');
    // Pobranie opłaty tylko jeśli wybrano "Płatność przy odbiorze"
    if (paymentEl && paymentEl.value.includes('Płatność przy odbiorze')) {
        paymentFee = parseFloat(paymentEl.dataset.cost) || 0;
    } else {
        paymentFee = 0; // Jeśli to szybki przelew lub bankowy, opłata to 0
    }
    
    const finalTotal = cartSubtotal + deliveryCost + paymentFee;
    
    return { finalTotal, deliveryCost, paymentFee, deliveryMethod: deliveryEl ? deliveryEl.value : 'Kurier DPD (15.00 PLN)', paymentMethod: paymentEl ? paymentEl.value : 'Przelew bankowy' };
}

/** Renderuje podsumowanie (po prawej stronie kasy) i podłącza eventy */
function renderCheckoutSummary() {
    const cart = getCart();
    const summaryItemsEl = document.getElementById('checkout-summary-items');
    const finalPriceEl = document.getElementById('final-price');

    if (!summaryItemsEl || !finalPriceEl) return;

    let subtotal = 0;
    let itemsHTML = '';

    cart.forEach(item => {
        const itemTotal = (item.price || 0) * (item.quantity || 0);
        subtotal += itemTotal;
        itemsHTML += `
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.9em; color: #CCC;">
                <span>${item.name} (x${item.quantity})</span>
                <span>${itemTotal.toFixed(2)} PLN</span>
            </div>
        `;
    });

    const { finalTotal, deliveryCost, paymentFee, deliveryMethod, paymentMethod } = calculateFinalPrice(subtotal);

    // Główne podsumowanie
    summaryItemsEl.innerHTML = `
        <p style="font-weight: 700;">PRODUKTY (${cart.length}): <span style="float: right;">${subtotal.toFixed(2)} PLN</span></p>
        ${itemsHTML}
        <hr style="border-color: #333; margin: 10px 0;">
        <p style="font-weight: 700;">DOSTAWA:</p>
        <div id="delivery-cost-line" style="display: flex; justify-content: space-between; margin-bottom: 8px;">
            <span id="delivery-method-display" style="color: #AAA;">${deliveryMethod}</span>
            <span id="delivery-cost-display" style="font-weight: 700;">+${deliveryCost.toFixed(2)} PLN</span>
        </div>
        
        <p style="font-weight: 700;">PŁATNOŚĆ:</p>
        <div id="payment-fee-line" style="display: flex; justify-content: space-between; margin-bottom: 8px;">
            <span id="payment-method-display" style="color: #AAA;">${paymentMethod}</span>
            <span id="payment-fee-display" style="font-weight: 700;">${paymentFee > 0 ? `+${paymentFee.toFixed(2)} PLN` : '0.00 PLN'}</span>
        </div>
    `;
    
    finalPriceEl.textContent = `${finalTotal.toFixed(2)} PLN`;

    // Podłączenie listenerów do radio buttonów, aby na bieżąco aktualizować podsumowanie
    document.querySelectorAll('input[name="delivery-method"]').forEach(el => {
        el.onchange = renderCheckoutSummary;
    });
    document.querySelectorAll('input[name="payment-method"]').forEach(el => {
        el.onchange = renderCheckoutSummary;
    });
}

/** NOWA WERSJA: Obsługuje wysłanie formularza kasy (zapisuje do Supabase) */
async function handleOrderSubmit(event) {
    event.preventDefault();

    // 1. Walidacja pustego koszyka (powinna być zrobiona w renderCartPage, ale jako zabezpieczenie)
    const cart = getCart();
    if (!Array.isArray(cart) || cart.length === 0) {
        alert('Twój koszyk jest pusty! Przejdź do kolekcji.');
        showPage('kolekcja-page');
        return;
    }

    // 2. Zablokuj przycisk
    const submitButton = document.querySelector('#checkout-form button[type="submit"]');
    if (submitButton) {
        submitButton.disabled = true;
        submitButton.textContent = 'Trwa składanie zamówienia...';
    }

    // 3. Zbierz dane z formularza
    const imie = document.getElementById('order-imie').value;
    const email = document.getElementById('order-email').value;
    const phone = document.getElementById('order-phone').value;
    const adres = document.getElementById('order-adres').value;
    const uwagi = document.getElementById('order-uwagi').value;
    
    const deliveryEl = document.querySelector('input[name="delivery-method"]:checked');
    const deliveryMethod = deliveryEl ? deliveryEl.value : 'Kurier DPD (15.00 PLN)';
    
    const paymentEl = document.querySelector('input[name="payment-method"]:checked');
    const paymentMethod = paymentEl ? paymentEl.value : 'Przelew bankowy';

    // 4. Oblicz ostateczną sumę
    let subtotal = cart.reduce((sum, item) => sum + (item.price || 0) * (item.quantity || 0), 0);
    const { finalTotal, deliveryCost, paymentFee } = calculateFinalPrice(subtotal);

    // 5. Stwórz obiekt zamówienia do Supabase
    const newOrder = {
        customer_name: imie,
        customer_email: email,
        customer_phone: phone, // Nowe pole
        customer_address: adres,
        delivery_method: deliveryMethod, // Nowe pole
        payment_method: paymentMethod, // Nowe pole
        delivery_cost: deliveryCost, // Nowe pole
        payment_fee: paymentFee, // Nowe pole
        notes: uwagi,
        items: cart,
        total_price: finalTotal
    };

    // 6. Wyślij dane do Supabase
    try {
        if (!supabase) throw new Error("Brak konfiguracji Supabase");
        
        const { data, error } = await supabase
            .from('zamowienia')
            .insert([newOrder])
            .select('id'); // Pobierz ID złożonego zamówienia

        if (error) throw error;
        
        const orderId = data[0].id;
        
        // 7. Sukces!
        alert(`Dziękujemy! Twoje zamówienie (ID: ${String(orderId).substring(0, 8)}...) na kwotę ${finalTotal.toFixed(2)} PLN zostało pomyślnie złożone. Otrzymasz wiadomość e-mail.`);
        
        // 8. Finalizacja - Wyczyść koszyk i przejdź do strony głównej
        saveCart([]);
        showPage('landing-page');
    
    } catch (error) {
        // 9. Obsługa błędu
        console.error('Błąd podczas składania zamówienia:', error.message);
        alert(`Wystąpił błąd podczas składania zamówienia: ${error.message}. Spróbuj ponownie lub skontaktuj się z nami.`);
        
        // Odblokuj przycisk w razie błędu
        if (submitButton) {
            submitButton.disabled = false;
            submitButton.textContent = 'ZŁÓŻ ZAMÓWIENIE Z OBOWIĄZKIEM ZAPŁATY';
        }
    }
}


         // ===============================================
         // === LOGIKA PANELU ADMINA (NOWA STRUKTURA) ===
         // ===============================================

         /** NOWOŚĆ: Renderuje główną "skorupę" panelu admina */
         function renderAdminPage() {
             const adminContent = document.getElementById('admin-content');
             if (!adminContent) return;

             // Wstrzyknij szablon
             const template = document.getElementById('admin-template');
             adminContent.innerHTML = ''; // Wyczyść
             adminContent.appendChild(document.importNode(template.content, true));

             // Domyślnie pokaż statystyki
             showAdminContent('stats');
         }

         /** NOWOŚĆ: Przełącza zawartość w panelu admina (Statystyki / Produkty) */
         async function showAdminContent(view) { // <-- DODANO 'async'
             const mainContent = document.getElementById('admin-main');
             if (!mainContent) return;

             const navLinks = document.querySelectorAll('#admin-page .dashboard-nav a');
             navLinks.forEach(link => link.classList.remove('active'));

             if (view === 'stats') {
                 const statsTemplate = document.getElementById('admin-stats-template');
                 mainContent.innerHTML = '';
                 mainContent.appendChild(document.importNode(statsTemplate.content, true));
                 document.getElementById('nav-admin-stats')?.classList.add('active');
                 
                 // Odpal renderowanie statystyk i listy zamówień
                await renderAdminStatsAndOrders();

             } else if (view === 'products') {
                 const productsTemplate = document.getElementById('admin-products-template');
                 mainContent.innerHTML = '';
                 mainContent.appendChild(document.importNode(productsTemplate.content, true));
                 document.getElementById('nav-admin-products')?.classList.add('active');

                 // Odpal renderowanie listy produktów (formularz jest w szablonie)
                 renderAdminProductList();
                 // Podłącz obsługę inputu plików i render podglądu (jeśli formularz jest w DOM)
                 setupAdminImageInput();
             }
         }

        /** ZAKTUALIZOWANA: Renderuje statystyki i listę zamówień z Supabase */
         async function renderAdminStatsAndOrders() {
             
             // 1. ZACIĄGNIJ DANE Z SUPABASE (zamiast getOrdersFromStorage())
             const { data: orders, error } = await supabase
                 .from('zamowienia')
                 .select('*')
                 .order('created_at', { ascending: false }); // Sortuj od najnowszych

             if (error) {
                 console.error("Błąd pobierania zamówień z Supabase:", error.message);
                 alert("Nie udało się pobrać listy zamówień. Sprawdź konsolę F12.");
             }

             // Użyj 'orders' z Supabase lub pustej tablicy, jeśli jest błąd
             const allOrders = orders || []; 

             // 2. Oblicz statystyki (używamy teraz nazw kolumn z bazy danych)
             const totalRevenue = allOrders.reduce((sum, order) => sum + (order.total_price || 0), 0);
             const totalOrders = allOrders.length;

             // 3. Wypełnij karty statystyk
             document.getElementById('stats-total-revenue').textContent = totalRevenue.toFixed(2) + ' PLN';
             document.getElementById('stats-total-orders').textContent = totalOrders;
             
             // 4. Wypełnij tabelę zamówień
             const listBody = document.getElementById('admin-orders-list-body');
             if (!listBody) return;
             listBody.innerHTML = '';

             if (allOrders.length === 0) {
                 listBody.innerHTML = '<tr><td colspan="6" style="text-align: center;">Brak zamówień w bazie.</td></tr>';
                 return;
             }

             /* NOWY BLOK W renderAdminStatsAndOrders (Linie 3000-3023): */
             // 5. ZMAPUJ NOWE DANE DO TABELI
             allOrders.forEach(order => {
                 const statusColor = order.status === 'Dostarczono' ? '#0A0' : order.status === 'Wysłano' ? '#F90' : (order.status === 'Oczekuje' ? '#C00' : '#888');
                 
                 const orderDate = new Date(order.created_at).toLocaleDateString('pl-PL'); 
                 let itemsText = 'Brak danych';
                 if (Array.isArray(order.items) && order.items.length > 0) {
                     itemsText = order.items.map(item => `${item.name} (x${item.quantity})`).join('; '); // Użyj średnika dla czytelności
                 }
                
                // Formatowanie metody dostawy (usuń koszt z nazwy metody dla czytelności)
                const deliveryName = (order.delivery_method || 'Brak danych').split('(')[0].trim();
                const paymentName = (order.payment_method || 'Brak danych').split('(')[0].trim();

                 listBody.innerHTML += `
                     <tr>
                         <td>${order.id.substring(0, 8)}...</td> 
                         <td>${orderDate}</td>
                         <td>${order.customer_email}<div style="font-size:0.8em; color:#AAA; max-width: 150px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" title="${order.customer_name} / ${order.customer_address}">${order.customer_name}, ${order.customer_address}</div></td>
                         <td>${order.customer_phone || 'Brak'}</td>
                         <td>${deliveryName} (${(order.delivery_cost || 0).toFixed(2)} PLN)</td>
                         <td>${paymentName}</td>
                         <td>${(order.total_price || 0).toFixed(2)} PLN</td>
                         <td><strong style="color: ${statusColor};">${order.status}</strong></td>
                     </tr>
                 `;
             });
         }

         /** Renderuje listę produktów w tabeli admina (teraz wywoływane przez showAdminContent) */
         function renderAdminProductList() {
             const listBody = document.getElementById('admin-product-list-body');
             if (!listBody) return;
             
             const products = getProductsFromStorage();
             listBody.innerHTML = ''; 

             if (products.length === 0) {
                 listBody.innerHTML = '<tr><td colspan="6" style="text-align: center;">Brak produktów w bazie.</td></tr>';
                 return;
             }

             products.forEach(p => {
                 listBody.innerHTML += `
                     <tr>
                         <td>${p.id}</td>
                        <td>${p.brand}</td>
                         <td>${p.name}</td>
                         <td>${p.price} PLN</td>
                         <td>${p.category}</td>
                         <td>
                             <button class="btn-admin-edit" onclick="populateAdminForm('${p.id}')">Edytuj</button>
                             <button class="btn-admin-delete" onclick="deleteProduct('${p.id}')">Usuń</button>
                         </td>
                     </tr>
                 `;
             });
         }

         /** Obsługuje wysłanie formularza admina (Dodawanie lub Edycja) */
         function handleAdminFormSubmit(event) {
             event.preventDefault();
             
             const productId = document.getElementById('admin-product-id').value;
             
             const productData = {
                 brand: document.getElementById('admin-brand').value,
                 name: document.getElementById('admin-name').value,
                 price: parseInt(document.getElementById('admin-price').value, 10),
                 category: document.getElementById('admin-category').value,
                 description: document.getElementById('admin-description').value,
                 specs: readSpecsFromForm(),
                 images: adminImageData.slice()
             };

             if (productId) {
                 // === TRYB EDYCJI ===
                 let products = getProductsFromStorage();
                 const updatedProducts = products.map(p => {
                     if (String(p.id) === String(productId)) { // Poprawka String()
                         return { ...p, ...productData, id: p.id }; // Zachowaj oryginalne ID
                     }
                     return p;
                 });
                 saveProductsToStorage(updatedProducts);
                 alert('Produkt zaktualizowany!');

             } else {
                // === TRYB DODAWANIA ===
                 let products = getProductsFromStorage();
                 const newProduct = {
                     ID: Date.now(), // <-- POPRAWKA: Duże ID i jest liczbą
                     ...productData
                 };
                 products.push(newProduct);
                 saveProductsToStorage(products);
                 alert('Nowy produkt dodany!');
             }

             clearAdminForm();
             renderAdminProductList();
             applyFilters(); // NOWOŚĆ: Odśwież też widok sklepu
         }

         /** Wypełnia formularz admina danymi do edycji */
         function populateAdminForm(productId) {
             const products = getProductsFromStorage();
             const productToEdit = products.find(p => String(p.id) === String(productId)); // Poprawka String()
             if (!productToEdit) return;

             document.getElementById('admin-product-id').value = productToEdit.id;
             document.getElementById('admin-brand').value = productToEdit.brand;
             document.getElementById('admin-name').value = productToEdit.name;
             document.getElementById('admin-price').value = productToEdit.price;
             document.getElementById('admin-category').value = productToEdit.category;
             
             document.getElementById('admin-description').value = productToEdit.description || '';
             setSpecsToForm(productToEdit.specs || []);
             
             // Załaduj obrazy produktu do formularza admina (edycja)
             adminImageData = (productToEdit.images && productToEdit.images.slice()) || [];
             renderAdminImagePreviews();
             
             document.getElementById('admin-form-title').textContent = 'Edytuj Produkt (ID: ' + productToEdit.id + ')';
             
             // Przewiń do formularza
             const formContainerEl = document.getElementById('admin-form-container');
             if (formContainerEl) {
                 window.scrollTo({ top: formContainerEl.offsetTop - 100, behavior: 'smooth' });
             }
         }

         /** Czyści formularz admina */
         function clearAdminForm() {
             const form = document.getElementById('admin-product-form');
             if (form) form.reset();
             document.getElementById('admin-product-id').value = '';
             document.getElementById('admin-form-title').textContent = 'Dodaj Nowy Produkt';
             const specsList = document.getElementById('admin-specs-list');
             if (specsList) specsList.innerHTML = '';

             // Czyść obrazy w formularzu
             adminImageData = [];
             const inputFile = document.getElementById('admin-images');
             if (inputFile) inputFile.value = '';
             const preview = document.getElementById('admin-image-previews');
             if (preview) preview.innerHTML = '';
         }


         function deleteProduct(productId) {
             if (!confirm('Czy na pewno chcesz trwale usunąć ten produkt? Tej akcji nie można cofnąć.')) {
                 return;
             }

             let products = getProductsFromStorage();
             const filteredProducts = products.filter(p => String(p.id) !== String(productId)); // Poprawka String()
             
             // Zapisz zmienioną listę do LocalStorage
             localStorage.setItem(LS_PRODUCTS_KEY, JSON.stringify(filteredProducts));
             
             // NOWOŚĆ: Usuń również z Supabase
             deleteProductFromSupabase(productId); 
             
             alert('Produkt usunięty.');
             renderAdminProductList(); 
             applyFilters(); // Odśwież widok sklepu
         }

         // --- FUNKCJE NAWIGACJI ---
        // (ZAKTUALIZOWANA FUNKCJA)
        function highlightNavLink(activePageId, activeSectionElement) {
            // Krok 1: Znajdź nawigację <nav> TYLKO wewnątrz aktywnej sekcji
            // To jest kluczowa poprawka - szukamy tylko w widocznym nagłówku
            const headerNav = activeSectionElement.querySelector('header nav');
            
            // Jeśli strona nie ma nawigacji (np. strona produktu), wyjdź
            if (!headerNav) {
                return; 
            }

            // Krok 2: Wyczyść wszystkie linki w TYM KONKRETNYM pasku nawigacji
            const allNavLinks = headerNav.querySelectorAll('a');
            allNavLinks.forEach(link => { link.classList.remove('active-nav-link'); });

            // Krok 3: Znajdź prefix ID linku, który ma być aktywny
            // (Ta logika była poprawna)
            let targetIdPrefix;
            if (activePageId.includes('kolekcja')) { targetIdPrefix = 'link-kolekcja'; } 
            else if (activePageId.includes('onas')) { targetIdPrefix = 'link-onas'; } 
            else if (activePageId.includes('regulamin')) { targetIdPrefix = 'link-regulamin'; } 
            else if (activePageId.includes('polityka')) { targetIdPrefix = 'link-polityka'; } 
            else if (activePageId.includes('zwroty')) { targetIdPrefix = 'link-zwroty'; } 
            else if (activePageId.includes('pomoc')) { targetIdPrefix = 'link-pomoc'; }
            else if (activePageId.includes('konto')) { targetIdPrefix = 'link-konto'; }
            else if (activePageId.includes('koszyk')) { targetIdPrefix = 'link-koszyk'; } 
            
            if (targetIdPrefix) {
                // Krok 4: Znajdź DOKŁADNY link w aktywnym pasku nawigacji
                // Na stronie "O Nas" (onas-page), szukamy linku o ID "link-onas"
                // Na stronie "Kolekcja" (kolekcja-page), szukamy linku o ID "link-kolekcja"
                const exactLinkToHighlight = headerNav.querySelector(`#${targetIdPrefix}`);
                
                if (exactLinkToHighlight) {
                    exactLinkToHighlight.classList.add('active-nav-link');
                } else {
                    // Drobna poprawka na wypadek, gdyby ID linków były różne (np. link-kolekcja-onas)
                    // Spróbuj znaleźć link, który zaczyna się od prefixu
                    const firstTry = headerNav.querySelector(`[id^="${targetIdPrefix}"]`);
                    if(firstTry) {
                         firstTry.classList.add('active-nav-link');
                    }
                }
            }
        }

        function scrollToElement(elementId) {
            const element = document.getElementById(elementId);
            if (element) { setTimeout(() => { element.scrollIntoView({ behavior: 'smooth', block: 'start' }); }, 100); }
        }

        function showPageAndScroll(pageId, elementId) {
            showPage(pageId);
            scrollToElement(elementId);
            // Ta linijka poniżej jest teraz zbędna, bo showPage() samo wywoła highlightNavLink
            // const targetPageId = pageId.split('-')[0];
            // highlightNavLink(targetPageId);
        }

        function openNav() { document.getElementById("side-menu").classList.add("open"); }
        function closeNav() { document.getElementById("side-menu").classList.remove("open"); }
        
        /** Główna funkcja nawigacyjna - z kontrolą dostępu (ZAKTUALIZOWANA) */
        function showPage(pageId) {
            // === KONTROLA DOSTĘPU ADMINA ===
            if (pageId === 'admin-page' && !isCurrentUserAdmin()) {
                alert('Nie masz uprawnień do tej strony. Zaloguj się jako administrator.');
                showPage(getIsLoggedIn() ? 'konto-page' : 'landing-page');
                return;
            }
            // === KONTROLA DOSTĘPU KLIENTA ===
            if (pageId === 'konto-page' && isCurrentUserAdmin()) {
                pageId = 'admin-page';
            }

           


            const sections = document.querySelectorAll('.page-section');
            sections.forEach(section => { section.classList.remove('active'); });
            
            // === ZMIANA ===
            // Pobieramy element sekcji, aby przekazać go do funkcji podświetlającej
            const activeSection = document.getElementById(pageId); 
            // === KONIEC ZMIANY ===

            if (activeSection) {
                activeSection.classList.add('active');
                const event = new CustomEvent('pageShow', { detail: { pageId: pageId } });
                document.dispatchEvent(event);
            } else {
                document.getElementById('landing-page').classList.add('active');
                return;
            }
            
            if (pageId !== 'landing-page') { 
                // === ZMIANA ===
                // Przekazujemy teraz ID strony ORAZ element aktywnej sekcji
                highlightNavLink(pageId, activeSection); 
                // === KONIEC ZMIANY ===
            } else { 
                document.querySelectorAll('header nav a').forEach(link => { link.classList.remove('active-nav-link'); }); 
            }
            
            window.scrollTo({ top: 0, behavior: 'smooth' });

// Inicjalizuj odpowiednie strony
            if (pageId === 'kolekcja-page') {
                applyFilters(); 
            }
            if (pageId === 'konto-page') {
                renderKontoPage();
            }
            if (pageId === 'admin-page') {
                renderAdminPage(); 
            }
            // ### KROK 3: DODANIE WYWOŁANIA RENDEROWANIA KOSZYKA ###
            if (pageId === 'koszyk-page') {
                renderCartPage();
            }
            // NOWOŚĆ: Dodaj wywołanie dla strony kasy
            if (pageId === 'checkout-page') {
                renderCheckoutSummary();
            }
        }

         // --- LOGIKA KONT (PANEL KLIENTA) ---
         function renderKontoPage() {
             const kontoContent = document.getElementById('konto-content');
             if (!kontoContent) return;

             kontoContent.innerHTML = ''; 
             
             if (getIsLoggedIn() && !isCurrentUserAdmin()) {
                 const template = document.getElementById('dashboard-template');
                 const clone = document.importNode(template.content, true);
                 kontoContent.appendChild(clone);
                 
                 document.getElementById('user-name-display').textContent = getUserName();
                 showDashboardContent('orders');
             } else {
                 const template = document.getElementById('auth-template');
                 const clone = document.importNode(template.content, true);
                 kontoContent.appendChild(clone);
             }
         }
         
         // ZMODYFIKOWANE: Używamy teraz bazy `pf_orders` zamiast `mockOrders`
         function showDashboardContent(view) {
             const mainContent = document.getElementById('dashboard-main');
             const navLinks = document.querySelectorAll('#user-dashboard .dashboard-nav a');
             
             navLinks.forEach(link => link.classList.remove('active'));
             const activeNav = document.getElementById(`nav-${view}`);
             if(activeNav) activeNav.classList.add('active');

             if (!mainContent) return;
             mainContent.innerHTML = '';
             
             if (view === 'orders') {
                 const currentUserEmail = getCurrentUser().email;
                 // Filtruj zamówienia tylko dla zalogowanego klienta
                 const userOrders = getOrdersFromStorage().filter(order => order.email === currentUserEmail);

                 let tableHTML = `
                     <h3>Historia Twoich Zamówień</h3>
                     <p>Poniżej znajdziesz listę wszystkich swoich transakcji.</p>
                     <table class="order-table">
                         <thead>
                             <tr>
                                 <th>Numer</th>
                                 <th>Data</th>
                                 <th>Produkt</th>
                                <th>Wartość</th>
                                 <th>Status</th>
                             </tr>
                         </thead>
                         <tbody>
                 `;
                 if (userOrders.length > 0) {
                     userOrders.forEach(order => {
                         const statusColor = order.status === 'Dostarczono' ? '#0A0' : order.status === 'Wysłano' ? '#F90' : '#C00';
                         tableHTML += `
                             <tr>
                                 <td>${order.id}</td>
                                 <td>${order.date}</td>
                                 <td>${order.items}</td>
                                 <td>${(order.total || 0).toFixed(2)} PLN</td>
                                 <td><strong style="color: ${statusColor};">${order.status}</strong></td>
                    </tr>
                         `;
                     });
                 } else {
                     tableHTML += '<tr><td colspan="5" style="text-align: center;">Nie złożyłeś jeszcze żadnego zamówienia.</td></tr>';
                 }
                 tableHTML += `</tbody></table>`;
                 mainContent.innerHTML = tableHTML;

             } else if (view === 'address') {
                 mainContent.innerHTML = `
                     <h3>Adresy Dostawy</h3>
                     <p>Główny adres:</p>
                     <div style="border: 1px solid #CCC; padding: 15px; margin-bottom: 20px;">
                         <strong>${getUserName()} Kowalski</strong><br>
                         ul. Elegancka 5/8<br>
                         01-234 Warszawa<br>
                         Tel: 555 666 777
                     </div>
                     <button class="btn-main" style="width: auto; padding: 10px 20px;">Edytuj Adres</button>
                 `;
             } else if (view === 'profile') {
                 mainContent.innerHTML = `
                     <h3>Edycja Danych Profilowych</h3>
                     <p>Możesz zmienić swoje dane osobowe oraz hasło.</p>
                     <form onsubmit="alert('Dane profilowe zostały zaktualizowane (symulacja)!'); return false;">
                         <div class="form-group" style="margin-bottom: 15px;">
                             <label>Nazwa użytkownika</label>
                             <input type="text" value="${getUserName()}" required>
                         </div>
                         <div class="form-group" style="margin-bottom: 15px;">
                             <label>Adres E-mail</label>
                             <input type="email" value="${getCurrentUser().email}" required>
                         </div>
                         <button type="submit" class="btn-main" style="width: auto; padding: 10px 20px;">Zapisz Zmiany</button>
                     </form>
                 `;
             }
         }

         // --- LOGIKA KOLEKCJI (FRONTEND) ---
        function renderProducts(products) {
             const grid = document.getElementById('product-grid');
             if (!grid) return; 
             
             const noProducts = document.getElementById('no-products'); 
             grid.innerHTML = ''; 
             
             if (products.length === 0) {
                 if (noProducts) {
                     noProducts.style.display = 'block';
                     grid.appendChild(noProducts); 
                 }
                 return;
             }
             if (noProducts) noProducts.style.display = 'none';

             products.forEach(product => {
                 const card = document.createElement('div');
                 card.className = 'product-card';
                 
                 // === ZAKTUALIZOWANY KOD KARTY PRODUKTU ===
                card.innerHTML = `
                <a href="javascript:void(0)" class="product-card-link" onclick="showProductDetail('${product.id}')">
                    <div class="product-card-image" style="background-image: url('${(product.images && product.images[0]) ? product.images[0] : ''}')">
                        </div>
                    <div class="product-card-info">
                        <div class="brand">${product.brand}</div>
                        <h3>${product.name || 'Brak Nazwy'}</h3>
                        <div class="price">${product.price} PLN</div>
                    </div>
                </a>
                `;
                 grid.appendChild(card);
             });
         }
         function applyFilters() {
             let filteredProducts = getProductsFromStorage();
             
             const selectedBrands = Array.from(document.querySelectorAll('#filter-sidebar input[data-filter="brand"]:checked')).map(cb => cb.value);
             const selectedCategories = Array.from(document.querySelectorAll('#filter-sidebar input[data-filter="category"]:checked')).map(cb => cb.value);
             
             if (selectedBrands.length > 0) {
                 filteredProducts = filteredProducts.filter(p => selectedBrands.includes(p.brand));
            }
             
             if (selectedCategories.length > 0) {
                 filteredProducts = filteredProducts.filter(p => selectedCategories.includes(p.category));
             }
             
             const sortByElement = document.getElementById('sort-by');
            if(sortByElement) {
                 const sortBy = sortByElement.value;
                 if (sortBy === 'price-asc') {
                     filteredProducts.sort((a, b) => a.price - b.price);
                 } else if (sortBy === 'price-desc') {
                     filteredProducts.sort((a, b) => b.price - a.price);
                 }
             }
             
             renderProducts(filteredProducts);
        }
         
         // --- NOWA LOGIKA CHATBOTA (v2 - Stanowa, Multi-intent, Supabase) ---

         // Definicje intencji i słów kluczowych
         const chatIntents = {
             GREETING: ['czesc', 'witaj', 'dzien dobry', 'hej', 'siema'],
             ORDER_STATUS: ['zamowienie', 'status', 'sledzenie', 'gdzie jest', 'paczka'],
             DELIVERY_INFO: ['dostawa', 'wysylka', 'czas', 'kurier', 'ile trwa'],
             ORIGINALITY_GUARANTEE: ['oryginalnosc', 'podrobka', 'gwarancja', 'autentycznosc', 'pewnosc'],
             RETURNS_COMPLAINTS: ['zwrot', 'reklamacja', 'uszkodzony', 'opakowanie', 'zepsuty'],
             PRODUCT_INFO: ['cena', 'kosztuje', 'jaki', 'zapach', 'dostepny', 'kupic'],
             CHANGE_ADDRESS: ['zmienic miejsce', 'zmienic adres', 'inny adres', 'miejsce odbioru'],
             CONTACT: ['kontakt', 'telefon', 'email', 'rozmowa', 'konsultant']
         };

         // Baza odpowiedzi
         const chatResponses = {
             GREETING: 'Cześć! W czym mogę Ci pomóc? Możesz zapytać o status zamówienia, gwarancję oryginalności lub zwroty.',
             ORDER_STATUS: 'Rozumiem, że chcesz sprawdzić status zamówienia. Proszę, podaj mi jego numer (np. 2025/10/29).',
             DELIVERY_INFO: 'Wysyłka w **ODORIS** jest realizowana zazwyczaj w ciągu <b>24 godzin</b>. Korzystamy z zaufanych kurierów (DPD/Inpost). Czas dostawy to standardowo 1-2 dni robocze. Chcesz dowiedzieć się więcej o <a onclick="showPage(\'regulamin-page\');">warunkach dostawy</a>?',
             ORIGINALITY_GUARANTEE: 'Wszystkie produkty są <b>100% oryginalne</b> i pochodzą bezpośrednio od autoryzowanych dystrybutorów. Gwarantujemy to naszą <a onclick="showPage(\'onas-page\');">Misją i Filozofią</a>.',
             RETURNS_COMPLAINTS: 'Pamiętaj, że ze względu na higienę, przyjmujemy zwroty w ciągu 14 dni tylko dla flakonów <b>z nienaruszoną plombą/folią fabryczną</b>. Szczegóły znajdziesz na stronie <a onclick="showPage(\'zwroty-page\');">Zwroty i Reklamacje</a>.',
             CHANGE_ADDRESS: 'Jeśli chodzi o zmianę miejsca odbioru lub adresu dostawy, jest to możliwe tylko <b>przed nadaniem paczki</b>. Proszę o pilny, bezpośredni kontakt z Biurem Obsługi Klienta pod numerem **532 116 720**.',
             CONTACT: 'Jeśli potrzebujesz bezpośredniego kontaktu z konsultantem, zadzwoń pod numer **532 116 720** (Pon-Pt, 9:00-17:00) lub napisz na <b>odoris.pl@gmail.com</b>.',
             PRODUCT_INFO_GENERIC: 'Informacje o cenie i dostępności danego produktu (np. Tom Ford, Creed) znajdziesz w naszym <a onclick="showPage(\'kolekcja-page\');">katalogu Kolekcji</a>. Użyj filtrów, aby znaleźć to, czego szukasz.',
             DEFAULT: 'Przepraszam, nie jestem pewien, jak Ci pomóc w tej kwestii. Jako AI, najlepiej radzę sobie z pytaniami o: <b>status zamówienia</b>, <b>wysyłkę</b>, <b>oryginalność</b> i <b>zwroty</b>. Czy możesz przeformułować swoje pytanie?',
             THANKS: 'Cieszę się, że mogłem pomóc! Czy masz jeszcze jakieś pytania?'
         };
         
         /** Dodaje wiadomość do historii czatu */
         function addMessage(text, type, id = null) {
             const history = document.getElementById('chat-history');
             if (!history) return;
             const msgDiv = document.createElement('div');
             msgDiv.className = type + '-message';
             msgDiv.innerHTML = text;
             if (id) {
                 msgDiv.id = id;
             }
             history.appendChild(msgDiv);
             history.scrollTop = history.scrollHeight;
             return msgDiv; // Zwróć element, aby móc go edytować (np. "pisze...")
        }
         
         /** Aktualizuje istniejącą wiadomość bota (np. usuwa "pisze...") */
         function updateMessage(element, newText) {
             if (element) {
                 element.innerHTML = newText;
                 element.classList.remove('typing');
             }
         }
         
         /** Wyświetla domyślne opcje na przyciskach */
         function displayDefaultOptions() {
             const optionsDiv = document.getElementById('chat-options');
             if (!optionsDiv) return;
             optionsDiv.innerHTML = `
                 <button onclick="handleOptionClick('Jaki jest status zamówienia?')">Status zamówienia</button>
                 <button onclick="handleOptionClick('Jak mogę zwrócić produkt?')">Zwroty i Reklamacje</button>
                 <button onclick="handleOptionClick('Czy perfumy są oryginalne?')">Gwarancja oryginalności</button>
                 <button onclick="handleOptionClick('Kontakt z konsultantem')">Kontakt</button>
            `;
             optionsDiv.style.display = 'block';
         }
         
         /** Obsługuje kliknięcie na przycisk opcji */
         function handleOptionClick(message) {
             const inputElement = document.getElementById('user-input');
             inputElement.value = message;
             sendChatMessage();
        }

         /** Główna funkcja wysyłająca wiadomość (teraz asynchroniczna) */
         async function sendChatMessage() {
             const inputElement = document.getElementById('user-input');
             const message = inputElement.value.trim();
             if (message === '') return;

             addMessage(message, 'client');
             inputElement.value = '';
             document.getElementById('chat-options').style.display = 'none';
             toggleChatInput(false); // Zablokuj input

             // Pokaż "Bot pisze..."
             const typingMsg = addMessage("...", 'bot typing');
             await new Promise(r => setTimeout(r, 800)); // Symulacja namysłu

             let response;
             
            // SPRAWDZENIE STANU ROZMOWY
             if (chatState === 'AWAITING_ORDER_NUMBER') {
                 response = await fetchOrderStatus(message);
             } else {
                 response = generateBotResponse(message);
             }
             
             // Aktualizuj wiadomość "pisze..." na pełną odpowiedź
             updateMessage(typingMsg, response.text);
             chatState = response.newState; // Ustaw nowy stan

             // Jeśli wracamy do stanu IDLE, pokaż opcje
             if (chatState === 'IDLE') {
                 displayDefaultOptions();
             }

             toggleChatInput(true); // Odblokuj input
         }

         /** Blokuje lub odblokowuje pole input */
         function toggleChatInput(enabled) {
             const inputElement = document.getElementById('user-input');
             const sendButton = document.querySelector('#chat-input-area button');
             if (!inputElement || !sendButton) return;
             
             inputElement.disabled = !enabled;
             sendButton.disabled = !enabled;
             
             if (enabled) {
                 inputElement.focus();
                 startPlaceholderCarousel();
             } else {
                 if (placeholderInterval) clearInterval(placeholderInterval);
             }
         }

         /** Analizuje tekst użytkownika i generuje odpowiedź */
         function generateBotResponse(text) {
             const lowerText = text.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
             
             let detectedIntents = [];
             for (const [intent, keywords] of Object.entries(chatIntents)) {
                 if (keywords.some(keyword => lowerText.includes(keyword))) {
                     detectedIntents.push(intent);
                 }
             }
             
             // Obsługa podziękowań
             if (['dziekuje', 'dzieki', 'super'].some(k => lowerText.includes(k))) {
                 return { text: chatResponses.THANKS, newState: 'IDLE' };
             }

             // Jeśli nic nie wykryto
             if (detectedIntents.length === 0) {
                 // Jeśli stan był IDLE i nic nie wykryto
                 if (chatState === 'IDLE') {
                     return { text: chatResponses.DEFAULT, newState: 'IDLE' };
                 }
                 // Jeśli był inny stan (np. AWAITING_...), ale nie pasuje, wróć do IDLE
                 return { text: chatResponses.DEFAULT, newState: 'IDLE' };
             }
             
             // --- Logika Multi-Intent ---
            // Budujemy jedną odpowiedź z wielu intencji
             
             let responseMessages = [];
             let nextState = 'IDLE';

             // Priorytet dla powitania
             if (detectedIntents.includes('GREETING') && detectedIntents.length === 1) {
                 return { text: chatResponses.GREETING, newState: 'IDLE' };
             }
             
             // Usuwamy powitanie, jeśli występuje z innymi intencjami
            detectedIntents = detectedIntents.filter(i => i !== 'GREETING');

             // Sprawdź, czy produkt jest w pytaniu
             const productMatch = getProductsFromStorage().find(p => lowerText.includes(p.brand.toLowerCase()) || lowerText.includes(p.name.toLowerCase().split('(')[0].trim().toLowerCase()));

             for (const intent of detectedIntents) {
                 switch (intent) {
                     case 'ORDER_STATUS':
                         responseMessages.push(chatResponses.ORDER_STATUS);
                         nextState = 'AWAITING_ORDER_NUMBER'; // Ustaw stan oczekiwania
                         break;
                     case 'PRODUCT_INFO':
                         if (productMatch) {
                             responseMessages.push(`Perfuma <b>${productMatch.brand} ${productMatch.name}</b> jest dostępna w cenie **${productMatch.price} PLN**. Możesz ją znaleźć w <a onclick="showPage('kolekcja-page');">Kolekcji</a>.`);
                         } else {
                             responseMessages.push(chatResponses.PRODUCT_INFO_GENERIC);
                         }
                         break;
                     default:
                         // Dodaj inne standardowe odpowiedzi
                         if (chatResponses[intent] && !responseMessages.includes(chatResponses[intent])) {
                             responseMessages.push(chatResponses[intent]);
                         }
                 }
             }

             // Jeśli jedyną intencją było ORDER_STATUS, stan jest już ustawiony
             // Jeśli było ich więcej (np. status I zmiana adresu), bot zapyta o numer,
             // ale też udzieli odpowiedzi na drugie pytanie.
             
             return {
                 text: responseMessages.join('<br><br>'), // Łączy odpowiedzi
                 newState: nextState
             };
         }

         /** NOWA FUNKCJA: Pobiera status zamówienia z Supabase */
         async function fetchOrderStatus(orderId) {
             // Walidacja, czy Supabase jest skonfigurowane
             if (!supabase) {
                 return { 
                     text: 'Funkcja sprawdzania statusu jest chwilowo niedostępna. (Brak konfiguracji Supabase). Proszę o kontakt telefoniczny.', 
                     newState: 'IDLE' 
                 };
             }
             
             // Walidacja formatu ID (dostosuj do swoich potrzeb)
             const orderIdFormatted = orderId.trim();
             if (orderIdFormatted.length < 5) {
                 return { 
                     text: 'Podany numer zamówienia wydaje się niepoprawny. Spróbuj ponownie (np. 2025/10/29).', 
                     newState: 'AWAITING_ORDER_NUMBER' // Pozostań w stanie oczekiwania
                 };
             }
             
             try {
                 // Załóżmy, że Twoja tabela w Supabase nazywa się 'zamowienia' (użyj nazwy swojej tabeli)
                 // i ma kolumny 'id', 'date' oraz 'status'.
                 // WAŻNE: W Supabase nazwy tabel i kolumn są wrażliwe na wielkość liter.
                 const { data, error } = await supabase
                     .from('zamowienia') // <-- ZMIEŃ NA NAZWĘ SWOJEJ TABELI
                     .select('date, status') // <-- ZMIEŃ NA NAZWY SWOICH KOLUMN
                     .eq('id', orderIdFormatted) // Szukaj po ID
                     .single(); // Oczekujemy jednego wyniku

                if (error || !data) {
                     console.error('Błąd Supabase:', error);
                     return { 
                         text: `Niestety, nie znalazłem w systemie zamówienia o numerze <b>${orderIdFormatted}</b>. Upewnij się, że numer jest poprawny i spróbuj ponownie.`, 
                         newState: 'IDLE' 
                     };
                 }

                 // Sukces!
                 return { 
                     text: `Mam! Zamówienie <b>${orderIdFormatted}</b> (złożone ${data.date}) ma obecnie status: <strong style="color:var(--color-accent-gold);">${data.status}</strong>.<br><br>Czy mogę pomóc w czymś jeszcze?`, 
                     newState: 'IDLE' 
                 };

             } catch (err) {
                 console.error('Błąd połączenia z Supabase:', err);
                 return { 
                     text: 'Wystąpił błąd podczas łączenia z bazą danych. Proszę, spróbuj ponownie za chwilę lub skontaktuj się z nami telefonicznie.', 
                     newState: 'IDLE' 
                 };
             }
         }
         
         // --- Karuzela placeholderów ---
        const popularQuestions = [
             "Wpisz: 'Cześć'",
             "Wpisz: 'Jaki jest status zamówienia?'",
             "Wpisz: 'Chcę zmienić miejsce odbioru'",
             "Wpisz: 'Cena Aventus'",
             "Wpisz: 'Kontakt z konsultantem'..."
         ];
         let placeholderIndex = 0;
         let placeholderInterval;

         function startPlaceholderCarousel() {
             const inputElement = document.getElementById('user-input');
             if (!inputElement || inputElement.disabled) return;
             if (placeholderInterval) {
                 clearInterval(placeholderInterval);
             }
             
             // Ustaw pierwszy od razu
             inputElement.placeholder = popularQuestions[placeholderIndex];
             
             placeholderInterval = setInterval(() => {
                 placeholderIndex = (placeholderIndex + 1) % popularQuestions.length;
                 
                 inputElement.style.transition = 'opacity 0.5s';
                 inputElement.style.opacity = '0.5';

                 setTimeout(() => {
                     inputElement.placeholder = popularQuestions[placeholderIndex];
                     inputElement.style.opacity = '1';
                 }, 500); 
             }, 3000); 
         }

         // === NOWE FUNKCJE: STRONA PRODUKTU I EDYCJA SPECYFIKACJI ===
         let currentDetailProductId = null;

         function showProductDetail(productId) {
             currentDetailProductId = productId;
             showPage('product-page');
             // renderProductDetail will be triggered via pageShow or directly:
             setTimeout(() => renderProductDetail(productId), 80);
         }

         function renderProductDetail(productId) {
             // === POPRAWKA BŁĘDU TYPÓW (Liczba vs Tekst) ===
             const p = getProductsFromStorage().find(x => String(x.id) === String(productId));
             
             if (!p) {
                 alert('Produkt nieznaleziony');
                 showPage('kolekcja-page');
                 return;
             }
             const imgEl = document.getElementById('detail-image');
             if (imgEl) {
                 if (p.images && p.images.length) imgEl.style.backgroundImage = `url(${p.images[0]})`;
                 else imgEl.style.backgroundImage = '';
             }
             document.getElementById('detail-brand').textContent = p.brand;
             document.getElementById('detail-name').textContent = p.name;
             document.getElementById('detail-price').textContent = p.price + ' PLN';
             document.getElementById('detail-description').innerHTML = p.description;

             const specsTable = document.getElementById('detail-specs');
             specsTable.innerHTML = '';
             if (p.specs && p.specs.length) {
                 p.specs.forEach(s => {
                     const row = document.createElement('tr');
                     row.innerHTML = `<td style="padding:6px;  width:35%;"><strong>${s.key}</strong></td><td style="padding:6px; ">${s.value}</td>`;
                     specsTable.appendChild(row);
                });
             } else {
                 specsTable.innerHTML = '<tr><td colspan="2" style="padding:6px; color:#666;">Brak specyfikacji</td></tr>';
             }

             // pokaż przycisk edycji tylko dla admina
             const editBtn = document.getElementById('detail-edit-btn');
             if (editBtn) {
                 if (isCurrentUserAdmin()) {
                     editBtn.style.display = 'inline-block';
                 } else {
                     editBtn.style.display = 'none';
                 }
             }

            // ---- nowa logika miniaturek ----
             const thumbsContainer = document.getElementById('detail-thumbnails');
             if (thumbsContainer) {
                 thumbsContainer.innerHTML = '';
                 if (p.images && p.images.length) {
                     p.images.forEach((src, idx) => {
                         const t = document.createElement('div');
                         t.style.width = '64px';
                         t.style.height = '64px';
                         // ZMIANA STYLI MINIATURY:
                         t.style.border = '2px solid transparent'; // Zwiększona ramka
                         t.style.overflow = 'hidden';
                         t.style.cursor = 'pointer';
                         t.style.borderRadius = '8px'; // DODANIE ZAOKRĄGLENIA
                         t.style.background = '#222';
                         t.style.transition = 'border-color 0.3s';
                         t.style.display = 'flex';
                         t.style.alignItems = 'center';
                         t.style.justifyContent = 'center';
                         
                         // Aktywna ramka dla wybranego obrazu
                         if (idx === 0) { // Oznaczenie pierwszej miniatury jako aktywnej
                            t.style.borderColor = 'var(--color-accent-gold)';
                         }

                         const img = document.createElement('img');
                         img.src = src;
                         img.style.width = '100%';
                         img.style.height = '100%';
                         img.style.objectFit = 'cover';
                         img.alt = 'thumb';

                         t.appendChild(img);
                         t.onclick = () => {
                             const imgEl2 = document.getElementById('detail-image');
                             if (imgEl2) imgEl2.style.backgroundImage = `url(${src})`;
                         };
                         thumbsContainer.appendChild(t);
                     });
                 }
             }
         }

         function addToCartFromDetail() {
             if (!currentDetailProductId) return;
             addToCart(currentDetailProductId);
         }

         function editProductFromDetail() {
             if (!isCurrentUserAdmin()) {
                 alert('Tylko administrator może edytować produkt.');
                 return;
             }
             showPage('admin-page');
             setTimeout(() => {
                 showAdminContent('products');
                 setTimeout(() => {
                     populateAdminForm(currentDetailProductId);
                 }, 150);
             }, 150);
         }

         // === SPEC FIELDS FOR ADMIN FORM ===
         function addSpecField(key='', value='') {
             const list = document.getElementById('admin-specs-list');
             if(!list) return;
             const id = 'spec-' + Date.now() + '-' + Math.floor(Math.random()*1000);
             const div = document.createElement('div');
             div.style.display = 'flex';
             div.style.gap = '8px';
             div.style.marginBottom = '8px';
             div.id = id;
             div.innerHTML = `
                 <input type="text" placeholder="Klucz" value="${escapeHtmlAttr(key)}" data-spec-key style="flex:1; padding:8px; border:1px solid #CCC;">
                 <input type="text" placeholder="Wartość" value="${escapeHtmlAttr(value)}" data-spec-value style="flex:1; padding:8px; border:1px solid #CCC;">
                 <button type="button" onclick="removeSpecField('${id}')" style="background:#e74c3c;color:#fff;border:none;padding:8px 10px;cursor:pointer;">Usuń</button>
             `;
             list.appendChild(div);
         }

         function removeSpecField(rowId) {
             const el = document.getElementById(rowId);
             if (el) el.remove();
         }

         function readSpecsFromForm() {
             const list = document.getElementById('admin-specs-list');
             if (!list) return [];
             const rows = Array.from(list.querySelectorAll('div'));
             const specs = [];
             rows.forEach(row => {
                 const keyInput = row.querySelector('[data-spec-key]');
                 const valueInput = row.querySelector('[data-spec-value]');
                 if (keyInput && valueInput && keyInput.value.trim() !== '') {
                     specs.push({ key: keyInput.value.trim(), value: valueInput.value.trim() });
                 }
             });
             return specs;
         }

         function setSpecsToForm(specs) {
             const list = document.getElementById('admin-specs-list');
             if (!list) return;
             list.innerHTML = '';
             if (specs && specs.length) {
                 specs.forEach(s => addSpecField(s.key, s.value));
             }
         }

         // Small utility to safely insert values into attributes
         function escapeHtmlAttr(s) {
             if (s === undefined || s === null) return '';
             return String(s).replace(/"/g, '&quot;').replace(/'/g, '&#39;');
         }

         // === OBSŁUGA ZDJĘĆ W PANELU ADMINA (localStorage jako dataURL) ===
         let adminImageData = []; // przechowuje dataURL obrazów aktualnie w formularzu (dodawanie/edycja)

         /** Wywołaj po wstrzyknięciu formularza admina: podłączy listener do input#admin-images */
         function setupAdminImageInput() {
           const input = document.getElementById('admin-images');
           if (!input) return;
           input.addEventListener('change', handleAdminImagesChange);
           // jeśli już istnieją obrazy w adminImageData (np. przy edycji), wyrenderuj je
           renderAdminImagePreviews();
         }

         /** Obsługa wyboru plików przez admina */
         function handleAdminImagesChange(event) {
           const files = Array.from(event.target.files || []);
           if (files.length === 0) return;

           const maxImages = 5;
           // jeśli dodanie plików przekroczy limit, obcinamy
          if (adminImageData.length + files.length > maxImages) {
             alert(`Możesz dodać maksymalnie ${maxImages} zdjęć na produkt. Usuń niektóre lub dodaj mniej plików.`);
           }

           // ogranicz liczbę plików do wstawienia
           const allowedToAdd = files.slice(0, Math.max(0, maxImages - adminImageData.length));
           allowedToAdd.forEach(file => {
             if (!file.type.startsWith('image/')) return;
             const reader = new FileReader();
             reader.onload = (e) => {
               adminImageData.push(e.target.result); // dataURL
               renderAdminImagePreviews();
             };
             reader.readAsDataURL(file);
          });

           // reset input, żeby ten sam plik mógł być wgrany ponownie po usunięciu
           event.target.value = '';
         }

         /** Renderuje miniatury obrazów w panelu admina z przyciskiem Usuń */
         function renderAdminImagePreviews() {
           const container = document.getElementById('admin-image-previews');
           if (!container) return;
           container.innerHTML = '';
           adminImageData.forEach((dataUrl, idx) => {
             const wrap = document.createElement('div');
             wrap.style.position = 'relative';
             wrap.style.width = '80px';
             wrap.style.height = '80px';
             wrap.style.flex = '0 0 80px';
             wrap.style.border = '1px solid #DDD';
             wrap.style.overflow = 'hidden';
             wrap.style.borderRadius = '4px';
             wrap.style.background = '#fff';

             const img = document.createElement('img');
             img.src = dataUrl;
             img.style.width = '100%';
            img.style.height = '100%';
             img.style.objectFit = 'cover';
             img.alt = 'preview';

             const btn = document.createElement('button');
             btn.textContent = '×';
             btn.title = 'Usuń';
             btn.style.position = 'absolute';
             btn.style.top = '3px';
             btn.style.right = '3px';
             btn.style.background = 'rgba(0,0,0,0.6)';
             btn.style.color = '#fff';
             btn.style.border = 'none';
             btn.style.width = '20px';
             btn.style.height = '20px';
             btn.style.borderRadius = '50%';
             btn.style.cursor = 'pointer';
             btn.onclick = () => removeAdminImage(idx);

             wrap.appendChild(img);
             wrap.appendChild(btn);
             container.appendChild(wrap);
           });

           // informacja o limicie
           const info = document.createElement('div');
           info.style.fontSize = '0.8em';
           info.style.color = '#666';
            info.style.alignSelf = 'center';
           info.style.marginLeft = '6px';
           info.textContent = `${adminImageData.length} / 5`;
           container.appendChild(info);
         }

         /** Usuwa obraz z listy (admin) */
         function removeAdminImage(index) {
           if (index < 0 || index >= adminImageData.length) return;
           adminImageData.splice(index, 1);
           renderAdminImagePreviews();
         }

         // --- LOGIKA CHAT, INICJALIZACJA STRONY I ZDARZEŃ ---
         
         document.addEventListener('DOMContentLoaded', async () => { // <-- POPRAWKA ASYNC
           
            
             // === NOWOŚĆ: Sprawdzenie sesji Supabase przy starcie ===
             try {
                 const { data: { session } } = await supabase.auth.getSession();
                 
                 if (session && session.user) {
                     // Mamy aktywną sesję w Supabase! Zalogujmy użytkownika lokalnie.
                     const user = session.user;
                     // Sprawdzamy czy to admin
                     const isAdmin = user.email === 'odoris.pl@gmail.com'; 
                     
                     const currentUser = {
                         email: user.email,
                         username: user.user_metadata.username || (isAdmin ? 'Administrator' : user.email.split('@')[0]),
                         isAdmin: isAdmin,
                         id: user.id
                    };
                     // Zapisujemy info do naszej lokalnej sesji, aby reszta skryptów działała
                     localStorage.setItem(LS_SESSION_KEY, JSON.stringify(currentUser));
                 } else {
                     // Brak sesji w Supabase, upewnij się, że lokalna też jest czysta
                     localStorage.removeItem(LS_SESSION_KEY);
                 }
            } catch (e) {
                 console.error("Błąd przywracania sesji:", e);
                 localStorage.removeItem(LS_SESSION_KEY);
             }
             // === INICJALIZACJA BAZ ===
             await initializeProductStorage(); // <-- POPRAWKA AWAIT
             initializeOrderStorage(); 
             
             // Wstrzykiwanie Stopki
             const fullFooterContent = `
                 <div class="container footer-content">
                     <div class="footer-links">
                         <h4>Informacje</h4>
                         <a onclick="showPage('polityka-page');">Polityka Prywatności</a>
                         <a onclick="showPage('regulamin-page');">Regulamin Sprzedaży</a>
                         <a onclick="showPage('zwroty-page');">Zwroty i Reklamacje</a>
                     </div>
                     <div class="footer-links">
                         <h4>ODORIS</h4>
                         <a onclick="showPage('kolekcja-page');">Katalog Zapachów</a>
                        <a onclick="showPage('onas-page');">O Naszej Misji</a>
                         <a onclick="showPage('pomoc-page');">Wsparcie i FAQ</a>
                         <a onclick="showPage('konto-page');">Moje Konto Klienta</a>
                     </div>
                     <div class="footer-contact">
                        <h4>&iquest; Masz Pytanie?</h4>
                         <strong class="gold-text">TELEFON:</strong> <a href="tel:532116720">532 116 720</a>
                         <strong class="gold-text">E-MAIL:</strong> <a href="mailto:odoris.pl@gmail.com">odoris.pl@gmail.com</a>
                     </div>
                     <div class="copyright">
                         <p>&copy; 2025 ODORIS. Wszelkie prawa zastrzeżone.</p>
                  </div>
                 </div>
             `;
             document.querySelectorAll('footer').forEach(footer => {
                 footer.innerHTML = fullFooterContent;
             });
             
             applyFilters(); // Uruchom po pobraniu danych

            document.addEventListener('pageShow', (e) => {

                 // --- Kod dla Chatbota na stronie Pomocy ---
              if (e.detail.pageId === 'pomoc-page') {
                     chatState = 'IDLE'; // Resetuj stan przy każdym otwarciu
                     document.getElementById('chat-history').innerHTML = '<div class="bot-message">Witaj! Jestem Bot Wsparcia. Jak mogę Ci pomóc?</div>'; // Wiadomość powitalna
                     displayDefaultOptions(); // Pokaż przyciski
                     toggleChatInput(true); // Odblokuj input
                     
                     const userInputEl = document.getElementById('user-input');
                     if (userInputEl && !userInputEl.dataset.listenerAttached) { // Zapobiegaj wielokrotnemu dodaniu listenera
                         userInputEl.addEventListener('keydown', function(event) {
                             if (event.key === 'Enter') {
                                 event.preventDefault();
                                 sendChatMessage();
                    }
                         });
                         userInputEl.dataset.listenerAttached = 'true';
                     }
                 }
                 
                 // --- Kod dla Strony Produktu (żeby linki działały) ---
              if (e.detail.pageId === 'product-page') {
                     // ensure details render if navigated directly
                     if (currentDetailProductId) renderProductDetail(currentDetailProductId);
                 }
             });

             showPage('landing-page');

            document.querySelectorAll('#filter-sidebar input[type="checkbox"]').forEach(checkbox => {
                 checkbox.addEventListener('change', applyFilters);
             });
             const sortByElement = document.getElementById('sort-by');
             if(sortByElement) sortByElement.addEventListener('change', applyFilters);

             updateSideMenu();
             
             // ### KROK 3: INICJALIZACJA LICZNIKA PRZY STARCIE ###
            updateCartCounters();
      // --- Logika akordeonu filtrów ---
    const filterToggles = document.querySelectorAll('.filter-group-toggle');
    filterToggles.forEach(toggle => {
         toggle.addEventListener('click', () => {
             // Znajdź rodzica .filter-group
             const group = toggle.parentElement;
             if (group && group.classList.contains('filter-group')) {
                // Przełącz klasę .active
                 group.classList.toggle('active');
             }
         });
    });
         });
     </script>
</body>
</html>
